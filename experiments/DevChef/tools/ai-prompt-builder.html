<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Prompt Builder - DevChef Tool</title>
</head>
<body>

<!-- DevChef Manifest -->
<script type="devchef-manifest">
{
  "id": "ai-prompt-builder",
  "name": "AI Prompt Builder",
  "category": "Developer Tools",
  "description": "Compose AI prompts with selectable personas, tech stacks, and smart file import from package.json",
  "keywords": ["ai", "prompt", "llm", "chatgpt", "claude", "composer", "rules", "personas"],
  "version": "2.0.0"
}
</script>

<!-- Tool UI Template -->
<template id="tool-ui">
  <div class="tool-container">
    <div class="tool-header">
      <h2 class="tool-title">AI Prompt Builder</h2>
      <p class="tool-description">Compose structured prompts with selectable personas and tech stack awareness</p>
    </div>

    <div class="tool-layout">
      <!-- Left Panel: Components -->
      <div class="components-panel">
        <div class="panel-header">
          <h3>Prompt Components</h3>
          <div class="panel-actions">
            <button id="import-file-btn" class="icon-btn" title="Import package.json / requirements.txt">üìÇ</button>
            <button id="import-config-btn" class="icon-btn" title="Import Configuration">üì•</button>
            <button id="export-config-btn" class="icon-btn" title="Export Configuration">üì§</button>
            <button id="reset-config-btn" class="icon-btn" title="Reset to Default">üîÑ</button>
          </div>
        </div>

        <div class="drop-zone" id="drop-zone">
          <div class="drop-zone-content">
            <div class="drop-icon">üìÅ</div>
            <div class="drop-text">Drop package.json or requirements.txt</div>
            <div class="drop-subtext">to auto-generate tech stack context</div>
          </div>
        </div>

        <div id="components-list" class="components-list">
          <!-- Components will be rendered here -->
        </div>

        <div class="add-component-section">
          <input type="text" id="new-component-name" placeholder="New component name..." />
          <button id="add-component-btn">+ Add Component</button>
        </div>
      </div>

      <!-- Right Panel: Preview & Export -->
      <div class="preview-panel">
        <div class="panel-header">
          <h3>Final Prompt</h3>
          <div class="panel-actions">
            <select id="export-format" class="format-select">
              <option value="structured">Structured</option>
              <option value="markdown">Markdown</option>
              <option value="plain">Plain Text</option>
            </select>
            <button id="copy-prompt-btn" class="primary">üìã Copy</button>
            <button id="save-prompt-btn" class="secondary">üíæ Save</button>
          </div>
        </div>

        <div class="preview-area">
          <textarea id="final-prompt" readonly placeholder="Your composed prompt will appear here..."></textarea>
        </div>

        <div class="stats-bar">
          <span id="char-count">0 characters</span>
          <span id="word-count">0 words</span>
          <span id="line-count">0 lines</span>
          <span id="placeholder-count">0 placeholders</span>
        </div>

        <div class="templates-section">
          <label class="section-label">Quick Templates</label>
          <div class="templates-grid">
            <button class="template-btn" data-template="code-review">Code Review</button>
            <button class="template-btn" data-template="data-analysis">Data Analysis</button>
            <button class="template-btn" data-template="content-writer">Content Writer</button>
            <button class="template-btn" data-template="tech-explainer">Tech Explainer</button>
            <button class="template-btn" data-template="architect">Solution Architect</button>
            <button class="template-btn" data-template="debugging">Debugging Assistant</button>
          </div>
        </div>
      </div>
    </div>

    <input type="file" id="file-input" accept=".json" style="display: none;">
    <input type="file" id="project-file-input" accept=".json,.txt" style="display: none;">
    <div id="status-message" class="status-message"></div>

    <!-- Persona Selection Modal -->
    <div id="persona-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Select a Persona</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="personas-grid" id="personas-grid">
            <!-- Personas will be rendered here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Tech Stack Selection Modal -->
    <div id="techstack-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Select Technology Stack</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="techstack-search">
            <input type="text" id="techstack-search" placeholder="Search technologies..." />
          </div>
          <div class="techstack-grid" id="techstack-grid">
            <!-- Tech stacks will be rendered here -->
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<!-- Tool Styles -->
<style>
  .tool-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 20px;
  }

  .components-panel,
  .preview-panel {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    max-height: calc(100vh - 250px);
  }

  .panel-header {
    padding: 16px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--bg-primary);
  }

  .panel-header h3 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
  }

  .panel-actions {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .icon-btn {
    background: transparent;
    border: 1px solid var(--border-color);
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s;
  }

  .icon-btn:hover {
    background: var(--bg-secondary);
    border-color: var(--primary-color);
  }

  .format-select {
    padding: 6px 10px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 13px;
    cursor: pointer;
  }

  .format-select:focus {
    outline: none;
    border-color: var(--primary-color);
  }

  .drop-zone {
    margin: 12px;
    padding: 30px;
    border: 2px dashed var(--border-color);
    border-radius: 8px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    background: var(--bg-primary);
  }

  .drop-zone:hover,
  .drop-zone.dragover {
    border-color: var(--primary-color);
    background: var(--bg-hover);
  }

  .drop-icon {
    font-size: 48px;
    margin-bottom: 12px;
    opacity: 0.6;
  }

  .drop-text {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 4px;
  }

  .drop-subtext {
    font-size: 12px;
    color: var(--text-secondary);
  }

  .components-list {
    flex: 1;
    overflow-y: auto;
    padding: 12px;
  }

  .component-item {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    margin-bottom: 12px;
    overflow: hidden;
    transition: all 0.2s;
  }

  .component-item.active {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 1px var(--primary-color);
  }

  .component-item.has-options {
    border-left: 3px solid var(--primary-color);
  }

  .component-header {
    padding: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--bg-secondary);
    cursor: pointer;
    user-select: none;
  }

  .component-header:hover {
    background: var(--bg-hover);
  }

  .component-toggle {
    width: 18px;
    height: 18px;
    border: 2px solid var(--border-color);
    border-radius: 3px;
    cursor: pointer;
    position: relative;
    flex-shrink: 0;
    transition: all 0.2s;
  }

  .component-toggle.checked {
    background: var(--primary-color);
    border-color: var(--primary-color);
  }

  .component-toggle.checked::after {
    content: '‚úì';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 12px;
    font-weight: bold;
  }

  .component-name {
    flex: 1;
    font-weight: 500;
    font-size: 14px;
    color: var(--text-primary);
  }

  .component-badge {
    font-size: 11px;
    padding: 2px 8px;
    background: var(--primary-color);
    color: white;
    border-radius: 10px;
    font-weight: 500;
  }

  .component-actions {
    display: flex;
    gap: 4px;
    opacity: 0;
    transition: opacity 0.2s;
  }

  .component-header:hover .component-actions {
    opacity: 1;
  }

  .component-action {
    background: transparent;
    border: none;
    padding: 4px 8px;
    cursor: pointer;
    font-size: 12px;
    border-radius: 3px;
    transition: background 0.2s;
  }

  .component-action:hover {
    background: var(--bg-primary);
  }

  .component-body {
    padding: 12px;
    display: none;
  }

  .component-item.expanded .component-body {
    display: block;
  }

  .component-body textarea {
    width: 100%;
    min-height: 100px;
    padding: 10px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-family: var(--font-mono);
    font-size: 13px;
    resize: vertical;
    background: var(--bg-primary);
    color: var(--text-primary);
  }

  .component-body textarea:focus {
    outline: none;
    border-color: var(--primary-color);
  }

  .component-select-btn {
    width: 100%;
    padding: 10px;
    margin-bottom: 8px;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    transition: background 0.2s;
  }

  .component-select-btn:hover {
    background: var(--primary-hover);
  }

  .component-meta {
    display: flex;
    gap: 12px;
    margin-top: 8px;
    font-size: 12px;
    color: var(--text-secondary);
  }

  .add-component-section {
    padding: 12px;
    border-top: 1px solid var(--border-color);
    display: flex;
    gap: 8px;
  }

  #new-component-name {
    flex: 1;
    padding: 8px 12px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 13px;
    background: var(--bg-primary);
    color: var(--text-primary);
  }

  #new-component-name:focus {
    outline: none;
    border-color: var(--primary-color);
  }

  #add-component-btn {
    padding: 8px 16px;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    transition: background 0.2s;
  }

  #add-component-btn:hover {
    background: var(--primary-hover);
  }

  .preview-area {
    flex: 1;
    padding: 16px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  #final-prompt {
    flex: 1;
    width: 100%;
    padding: 12px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-family: var(--font-mono);
    font-size: 13px;
    line-height: 1.6;
    resize: none;
    background: var(--bg-primary);
    color: var(--text-primary);
  }

  #final-prompt:focus {
    outline: none;
    border-color: var(--primary-color);
  }

  .stats-bar {
    padding: 12px 16px;
    border-top: 1px solid var(--border-color);
    display: flex;
    gap: 24px;
    font-size: 12px;
    color: var(--text-secondary);
    background: var(--bg-primary);
    flex-wrap: wrap;
  }

  .templates-section {
    padding: 16px;
    border-top: 1px solid var(--border-color);
  }

  .templates-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 8px;
    margin-top: 12px;
  }

  .template-btn {
    padding: 8px 12px;
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.2s;
    color: var(--text-primary);
  }

  .template-btn:hover {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
  }

  .status-message {
    margin-top: 16px;
    padding: 12px;
    border-radius: 4px;
    font-size: 13px;
    display: none;
  }

  .status-message.show {
    display: block;
  }

  .status-message.success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }

  .status-message.error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }

  .status-message.info {
    background: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }

  .modal.show {
    display: flex;
  }

  .modal-content {
    background: var(--bg-primary);
    border-radius: 8px;
    max-width: 800px;
    width: 90%;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }

  .modal-header {
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modal-header h3 {
    margin: 0;
    font-size: 18px;
    color: var(--text-primary);
  }

  .modal-close {
    background: transparent;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--text-secondary);
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: background 0.2s;
  }

  .modal-close:hover {
    background: var(--bg-hover);
  }

  .modal-body {
    padding: 20px;
    overflow-y: auto;
    flex: 1;
  }

  .personas-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 12px;
  }

  .persona-card {
    padding: 16px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--bg-secondary);
  }

  .persona-card:hover {
    border-color: var(--primary-color);
    background: var(--bg-hover);
  }

  .persona-card.selected {
    border-color: var(--primary-color);
    background: var(--primary-color);
    color: white;
  }

  .persona-name {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 8px;
  }

  .persona-description {
    font-size: 12px;
    color: var(--text-secondary);
    line-height: 1.4;
  }

  .persona-card.selected .persona-description {
    color: rgba(255, 255, 255, 0.9);
  }

  .techstack-search {
    margin-bottom: 16px;
  }

  .techstack-search input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 14px;
    background: var(--bg-secondary);
    color: var(--text-primary);
  }

  .techstack-search input:focus {
    outline: none;
    border-color: var(--primary-color);
  }

  .techstack-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 8px;
  }

  .techstack-item {
    padding: 12px;
    border: 2px solid var(--border-color);
    border-radius: 6px;
    cursor: pointer;
    text-align: center;
    transition: all 0.2s;
    background: var(--bg-secondary);
    font-size: 13px;
    font-weight: 500;
  }

  .techstack-item:hover {
    border-color: var(--primary-color);
    background: var(--bg-hover);
  }

  .techstack-item.selected {
    border-color: var(--primary-color);
    background: var(--primary-color);
    color: white;
  }

  @media (max-width: 1024px) {
    .tool-layout {
      grid-template-columns: 1fr;
    }

    .personas-grid {
      grid-template-columns: 1fr;
    }

    .techstack-grid {
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    }
  }
</style>

<!-- Tool Module -->
<script type="module">
  // Persona library
  const PERSONAS = [
    {
      id: 'senior-engineer',
      name: 'Senior Software Engineer',
      description: 'Expert in modern development practices, design patterns, and clean code principles.',
      content: 'You are a senior software engineer with 10+ years of experience in modern development practices, design patterns, and clean code principles. You have deep expertise in software architecture, code quality, and best practices.'
    },
    {
      id: 'code-reviewer',
      name: 'Code Reviewer',
      description: 'Focused on code quality, security, performance, and maintainability.',
      content: 'You are a meticulous code reviewer with expertise in identifying code quality issues, security vulnerabilities, performance bottlenecks, and maintainability concerns. You provide constructive feedback focused on best practices.'
    },
    {
      id: 'architect',
      name: 'Solution Architect',
      description: 'Designs scalable, maintainable systems with focus on architecture patterns.',
      content: 'You are a solution architect specializing in designing scalable, maintainable, and robust systems. You have expertise in architectural patterns, system design, microservices, and cloud architecture.'
    },
    {
      id: 'devops-engineer',
      name: 'DevOps Engineer',
      description: 'Expert in CI/CD, infrastructure, containers, and automation.',
      content: 'You are a DevOps engineer with expertise in CI/CD pipelines, infrastructure as code, containerization (Docker, Kubernetes), cloud platforms (AWS, Azure, GCP), and automation.'
    },
    {
      id: 'security-expert',
      name: 'Security Expert',
      description: 'Focuses on security best practices, vulnerabilities, and secure coding.',
      content: 'You are a security expert specializing in application security, secure coding practices, vulnerability assessment, and security best practices. You focus on OWASP top 10, authentication, authorization, and data protection.'
    },
    {
      id: 'data-analyst',
      name: 'Data Analyst',
      description: 'Expert in statistical analysis, data visualization, and insights.',
      content: 'You are a data analyst with expertise in statistical analysis, data visualization, SQL, Python/R, and extracting actionable insights from data. You understand data cleaning, transformation, and storytelling.'
    },
    {
      id: 'frontend-specialist',
      name: 'Frontend Specialist',
      description: 'Expert in modern frontend frameworks, UX, and web performance.',
      content: 'You are a frontend specialist with deep knowledge of React, Vue, Angular, TypeScript, CSS, and modern web development. You understand UX principles, accessibility, and web performance optimization.'
    },
    {
      id: 'backend-specialist',
      name: 'Backend Specialist',
      description: 'Expert in APIs, databases, server architecture, and scalability.',
      content: 'You are a backend specialist with expertise in REST/GraphQL APIs, database design, server architecture, caching strategies, and building scalable backend systems. You know Node.js, Python, Java, Go, and database technologies.'
    },
    {
      id: 'tech-educator',
      name: 'Technical Educator',
      description: 'Explains complex concepts in simple, understandable terms.',
      content: 'You are a technical educator who excels at breaking down complex technical concepts into simple, understandable explanations. You use analogies, examples, and step-by-step breakdowns to teach effectively.'
    },
    {
      id: 'qa-engineer',
      name: 'QA Engineer',
      description: 'Expert in testing strategies, test automation, and quality assurance.',
      content: 'You are a QA engineer with expertise in testing strategies, test automation, unit/integration/e2e testing, and quality assurance best practices. You understand testing frameworks and ensure software reliability.'
    },
    {
      id: 'technical-writer',
      name: 'Technical Writer',
      description: 'Creates clear documentation, API docs, and technical content.',
      content: 'You are a technical writer specializing in creating clear, comprehensive documentation, API documentation, user guides, and technical content. You understand how to make complex technical information accessible.'
    },
    {
      id: 'content-writer',
      name: 'Content Writer',
      description: 'Professional writer for blogs, marketing, and storytelling.',
      content: 'You are a professional content writer with expertise in technical writing, copywriting, blog posts, marketing content, and storytelling. You adapt tone and style to the target audience.'
    }
  ];

  // Technology stack library
  const TECH_STACKS = {
    'Frontend': ['React', 'Vue.js', 'Angular', 'Svelte', 'Next.js', 'Nuxt.js', 'TypeScript', 'JavaScript', 'HTML/CSS', 'Tailwind CSS', 'Bootstrap'],
    'Backend': ['Node.js', 'Python', 'Java', 'Go', 'Rust', 'PHP', 'Ruby', 'C#/.NET', 'Elixir', 'Scala'],
    'Frameworks': ['Express.js', 'Django', 'Flask', 'FastAPI', 'Spring Boot', 'Laravel', 'Ruby on Rails', 'ASP.NET Core'],
    'Databases': ['PostgreSQL', 'MySQL', 'MongoDB', 'Redis', 'Elasticsearch', 'SQLite', 'DynamoDB', 'Cassandra', 'Neo4j'],
    'Cloud': ['AWS', 'Azure', 'Google Cloud', 'Vercel', 'Netlify', 'Heroku', 'DigitalOcean', 'Cloudflare'],
    'DevOps': ['Docker', 'Kubernetes', 'Jenkins', 'GitHub Actions', 'GitLab CI', 'Terraform', 'Ansible', 'Prometheus', 'Grafana'],
    'Mobile': ['React Native', 'Flutter', 'Swift', 'Kotlin', 'Ionic', 'Xamarin'],
    'Data': ['Pandas', 'NumPy', 'TensorFlow', 'PyTorch', 'Scikit-learn', 'Apache Spark', 'Airflow', 'Jupyter']
  };

  // Default configuration with enhanced components
  const DEFAULT_CONFIG = {
    components: [
      {
        id: 'role',
        name: 'Role / Persona',
        enabled: true,
        order: 1,
        hasOptions: true,
        selectedPersona: 'senior-engineer',
        content: PERSONAS[0].content
      },
      {
        id: 'tech-stack',
        name: 'Technology Stack',
        enabled: true,
        order: 2,
        hasOptions: true,
        selectedStacks: [],
        content: 'Technology stack: {{tech_stack}}\n\nPlease provide solutions and examples specific to these technologies.'
      },
      {
        id: 'context',
        name: 'Context / Background',
        enabled: true,
        order: 3,
        content: 'Project: {{project_name}}\nDomain: {{domain}}\nKey requirements: {{requirements}}'
      },
      {
        id: 'task',
        name: 'Task / Objective',
        enabled: true,
        order: 4,
        content: '{{task_description}}'
      },
      {
        id: 'rules',
        name: 'Processing Rules',
        enabled: true,
        order: 5,
        content: `Follow these rules:
- Provide clear, actionable guidance
- Include code examples when relevant
- Explain your reasoning step-by-step
- Consider edge cases and error handling
- Follow industry best practices
- Be specific and avoid vague recommendations`
      },
      {
        id: 'output-format',
        name: 'Output Format',
        enabled: true,
        order: 6,
        content: `Structure your response as:
1. Brief summary (1-2 sentences)
2. Detailed explanation with step-by-step breakdown
3. Code examples with inline comments
4. Testing approach and edge cases
5. Best practices and recommendations`
      },
      {
        id: 'constraints',
        name: 'Constraints / Limitations',
        enabled: false,
        order: 7,
        content: 'Technical constraints:\n- {{constraint_1}}\n- {{constraint_2}}\n- {{constraint_3}}'
      },
      {
        id: 'examples',
        name: 'Examples / References',
        enabled: false,
        order: 8,
        content: 'Reference examples:\n{{examples}}'
      }
    ]
  };

  // Enhanced templates
  const TEMPLATES = {
    'code-review': {
      name: 'Code Review Assistant',
      components: [
        {
          id: 'role',
          name: 'Role / Persona',
          enabled: true,
          order: 1,
          hasOptions: true,
          selectedPersona: 'code-reviewer',
          content: PERSONAS.find(p => p.id === 'code-reviewer').content
        },
        {
          id: 'task',
          name: 'Code to Review',
          enabled: true,
          order: 2,
          content: '{{code_snippet}}'
        },
        {
          id: 'rules',
          name: 'Review Criteria',
          enabled: true,
          order: 3,
          content: `Review the code for:
- Code quality and readability
- Performance issues and optimizations
- Security vulnerabilities (OWASP top 10)
- Best practices adherence
- Potential bugs and edge cases
- Maintainability and scalability concerns
- Test coverage gaps`
        },
        {
          id: 'output-format',
          name: 'Output Format',
          enabled: true,
          order: 4,
          content: `Structure your review as:
1. Overall assessment (1-2 sentences)
2. Critical issues (MUST fix - security, bugs)
3. Important suggestions (SHOULD fix - performance, best practices)
4. Minor improvements (COULD fix - style, optimization)
5. Positive highlights (what's done well)
6. Refactored code example (if applicable)`
        }
      ]
    },
    'data-analysis': {
      name: 'Data Analysis Assistant',
      components: [
        {
          id: 'role',
          name: 'Role / Persona',
          enabled: true,
          order: 1,
          hasOptions: true,
          selectedPersona: 'data-analyst',
          content: PERSONAS.find(p => p.id === 'data-analyst').content
        },
        {
          id: 'context',
          name: 'Dataset Context',
          enabled: true,
          order: 2,
          content: 'Dataset: {{dataset_name}}\nSource: {{data_source}}\nSize: {{record_count}} records\nKey fields: {{field_list}}\nTime period: {{time_period}}'
        },
        {
          id: 'task',
          name: 'Analysis Objective',
          enabled: true,
          order: 3,
          content: '{{analysis_objective}}'
        },
        {
          id: 'output-format',
          name: 'Output Format',
          enabled: true,
          order: 4,
          content: `Provide:
1. Executive summary (key findings in 3-5 bullet points)
2. Statistical summary (mean, median, std dev, outliers)
3. Data quality assessment (missing values, anomalies)
4. Visualization recommendations (chart types, variables)
5. Actionable insights with business impact
6. Recommendations for next analysis steps
7. Python/SQL code snippets for analysis`
        }
      ]
    },
    'content-writer': {
      name: 'Content Writer',
      components: [
        {
          id: 'role',
          name: 'Role / Persona',
          enabled: true,
          order: 1,
          hasOptions: true,
          selectedPersona: 'content-writer',
          content: PERSONAS.find(p => p.id === 'content-writer').content
        },
        {
          id: 'task',
          name: 'Writing Brief',
          enabled: true,
          order: 2,
          content: 'Topic: {{topic}}\nTarget audience: {{audience}}\nTone: {{tone}}\nKey message: {{key_message}}'
        },
        {
          id: 'rules',
          name: 'Writing Guidelines',
          enabled: true,
          order: 3,
          content: `Guidelines:
- Use clear, engaging language appropriate for {{audience}}
- Maintain {{tone}} tone throughout
- Include concrete examples and case studies
- Break up text with subheadings and bullet points
- Use active voice and strong verbs
- End with clear call-to-action or key takeaways`
        },
        {
          id: 'constraints',
          name: 'Constraints',
          enabled: true,
          order: 4,
          content: 'Word count: {{word_count}}\nSEO keywords: {{keywords}}\nContent type: {{content_type}}'
        }
      ]
    },
    'tech-explainer': {
      name: 'Technical Explainer',
      components: [
        {
          id: 'role',
          name: 'Role / Persona',
          enabled: true,
          order: 1,
          hasOptions: true,
          selectedPersona: 'tech-educator',
          content: PERSONAS.find(p => p.id === 'tech-educator').content
        },
        {
          id: 'task',
          name: 'Concept to Explain',
          enabled: true,
          order: 2,
          content: 'Explain: {{technical_concept}}\nAudience level: {{beginner/intermediate/advanced}}'
        },
        {
          id: 'rules',
          name: 'Explanation Principles',
          enabled: true,
          order: 3,
          content: `Follow these principles:
- Start with a simple real-world analogy
- Build understanding from basics to advanced
- Use concrete examples and diagrams
- Avoid unnecessary jargon (or explain when needed)
- Include practical applications and use cases
- Address common misconceptions`
        },
        {
          id: 'output-format',
          name: 'Output Format',
          enabled: true,
          order: 4,
          content: `Structure:
1. Simple analogy (ELI5 - Explain Like I'm 5)
2. Core concept explanation (what it is)
3. How it works (step-by-step breakdown)
4. Real-world examples and use cases
5. Benefits and trade-offs
6. Common misconceptions and FAQs
7. Next steps for deeper learning`
        }
      ]
    },
    'architect': {
      name: 'Solution Architect',
      components: [
        {
          id: 'role',
          name: 'Role / Persona',
          enabled: true,
          order: 1,
          hasOptions: true,
          selectedPersona: 'architect',
          content: PERSONAS.find(p => p.id === 'architect').content
        },
        {
          id: 'tech-stack',
          name: 'Technology Stack',
          enabled: true,
          order: 2,
          hasOptions: true,
          selectedStacks: [],
          content: 'Technology stack: {{tech_stack}}'
        },
        {
          id: 'task',
          name: 'Architecture Challenge',
          enabled: true,
          order: 3,
          content: 'System to design: {{system_description}}\nScale: {{user_count}} users, {{request_rate}} requests/sec\nKey requirements: {{requirements}}'
        },
        {
          id: 'rules',
          name: 'Design Principles',
          enabled: true,
          order: 4,
          content: `Consider:
- Scalability and performance requirements
- Security and compliance needs
- High availability and fault tolerance
- Cost optimization
- Maintainability and developer experience
- Technology trade-offs and alternatives`
        },
        {
          id: 'output-format',
          name: 'Output Format',
          enabled: true,
          order: 5,
          content: `Provide:
1. High-level architecture overview
2. Component breakdown with responsibilities
3. Data flow and communication patterns
4. Technology choices with justification
5. Scalability strategy
6. Security considerations
7. Potential bottlenecks and mitigation
8. Architecture diagram (ASCII or description)`
        }
      ]
    },
    'debugging': {
      name: 'Debugging Assistant',
      components: [
        {
          id: 'role',
          name: 'Role / Persona',
          enabled: true,
          order: 1,
          hasOptions: true,
          selectedPersona: 'senior-engineer',
          content: 'You are a senior debugging expert with deep experience in troubleshooting complex issues across different technologies. You follow systematic debugging approaches and help identify root causes.'
        },
        {
          id: 'context',
          name: 'Environment',
          enabled: true,
          order: 2,
          content: 'Environment: {{environment}}\nTech stack: {{tech_stack}}\nError occurred: {{when_occurred}}'
        },
        {
          id: 'task',
          name: 'Issue Description',
          enabled: true,
          order: 3,
          content: 'Error message: {{error_message}}\n\nCode snippet:\n{{code_snippet}}\n\nExpected behavior: {{expected}}\nActual behavior: {{actual}}'
        },
        {
          id: 'rules',
          name: 'Debugging Approach',
          enabled: true,
          order: 4,
          content: `Follow systematic debugging:
1. Reproduce the issue
2. Isolate the root cause
3. Verify assumptions with evidence
4. Consider recent changes
5. Check logs and stack traces
6. Test hypotheses incrementally`
        },
        {
          id: 'output-format',
          name: 'Output Format',
          enabled: true,
          order: 5,
          content: `Provide:
1. Root cause analysis (what's causing the issue)
2. Step-by-step fix with code examples
3. Why this solution works (explanation)
4. How to verify the fix
5. How to prevent similar issues
6. Additional debugging tips if issue persists`
        }
      ]
    }
  };

  let state = {
    config: JSON.parse(JSON.stringify(DEFAULT_CONFIG)),
    currentModal: null
  };

  export function init(context) {
    console.log('AI Prompt Builder v2.0 initialized');

    // Load saved configuration
    loadConfig();

    // Render components
    renderComponents();
    updatePreview();

    // Event listeners
    setupEventListeners();
    setupDropZone();
    setupModals();
  }

  export function cleanup(context) {
    console.log('AI Prompt Builder cleanup');
    saveConfig();
  }

  function setupEventListeners() {
    document.getElementById('add-component-btn').addEventListener('click', handleAddComponent);
    document.getElementById('new-component-name').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') handleAddComponent();
    });

    document.getElementById('copy-prompt-btn').addEventListener('click', handleCopyPrompt);
    document.getElementById('save-prompt-btn').addEventListener('click', handleSavePrompt);
    document.getElementById('import-file-btn').addEventListener('click', handleImportProjectFile);
    document.getElementById('import-config-btn').addEventListener('click', handleImportConfig);
    document.getElementById('export-config-btn').addEventListener('click', handleExportConfig);
    document.getElementById('reset-config-btn').addEventListener('click', handleResetConfig);

    // Export format change
    document.getElementById('export-format').addEventListener('change', updatePreview);

    // Template buttons
    document.querySelectorAll('.template-btn').forEach(btn => {
      btn.addEventListener('click', () => loadTemplate(btn.dataset.template));
    });

    // Component list delegation
    document.getElementById('components-list').addEventListener('click', handleComponentClick);
    document.getElementById('components-list').addEventListener('input', handleComponentInput);
  }

  function setupDropZone() {
    const dropZone = document.getElementById('drop-zone');

    dropZone.addEventListener('click', () => {
      document.getElementById('project-file-input').click();
    });

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('dragover');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('dragover');

      const file = e.dataTransfer.files[0];
      if (file) {
        processProjectFile(file);
      }
    });

    document.getElementById('project-file-input').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        processProjectFile(file);
      }
    });
  }

  function setupModals() {
    // Close modals on background click or close button
    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal || e.target.classList.contains('modal-close')) {
          closeModal();
        }
      });
    });

    // Tech stack search
    document.getElementById('techstack-search').addEventListener('input', (e) => {
      filterTechStacks(e.target.value);
    });
  }

  function processProjectFile(file) {
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const content = e.target.result;
        let techInfo = { technologies: [], description: '' };

        if (file.name === 'package.json') {
          techInfo = parsePackageJson(content);
        } else if (file.name === 'requirements.txt') {
          techInfo = parseRequirementsTxt(content);
        }

        if (techInfo.technologies.length > 0) {
          updateTechStackComponent(techInfo);
          showStatus(`Detected ${techInfo.technologies.length} technologies from ${file.name}`, 'success');
        } else {
          showStatus('No technologies detected in file', 'info');
        }
      } catch (error) {
        showStatus(`Error processing file: ${error.message}`, 'error');
      }
    };
    reader.readAsText(file);
  }

  function parsePackageJson(content) {
    const data = JSON.parse(content);
    const technologies = [];
    const deps = { ...data.dependencies, ...data.devDependencies };

    // Map common npm packages to technologies
    const techMap = {
      'react': 'React',
      'vue': 'Vue.js',
      'angular': 'Angular',
      '@angular/core': 'Angular',
      'svelte': 'Svelte',
      'next': 'Next.js',
      'nuxt': 'Nuxt.js',
      'express': 'Express.js',
      'typescript': 'TypeScript',
      'webpack': 'Webpack',
      'vite': 'Vite',
      'tailwindcss': 'Tailwind CSS',
      'bootstrap': 'Bootstrap',
      'jest': 'Jest',
      'vitest': 'Vitest',
      'cypress': 'Cypress',
      'playwright': 'Playwright'
    };

    Object.keys(deps).forEach(pkg => {
      const tech = techMap[pkg] || techMap[pkg.split('/').pop()];
      if (tech && !technologies.includes(tech)) {
        technologies.push(tech);
      }
    });

    // Add Node.js if package.json exists
    if (!technologies.includes('Node.js')) {
      technologies.unshift('Node.js');
    }

    return {
      technologies,
      description: data.description || ''
    };
  }

  function parseRequirementsTxt(content) {
    const technologies = ['Python'];
    const lines = content.split('\n');

    const techMap = {
      'django': 'Django',
      'flask': 'Flask',
      'fastapi': 'FastAPI',
      'pandas': 'Pandas',
      'numpy': 'NumPy',
      'tensorflow': 'TensorFlow',
      'pytorch': 'PyTorch',
      'scikit-learn': 'Scikit-learn',
      'requests': 'Python Requests',
      'sqlalchemy': 'SQLAlchemy'
    };

    lines.forEach(line => {
      const pkg = line.split('==')[0].split('>=')[0].trim().toLowerCase();
      const tech = techMap[pkg];
      if (tech && !technologies.includes(tech)) {
        technologies.push(tech);
      }
    });

    return { technologies, description: '' };
  }

  function updateTechStackComponent(techInfo) {
    const component = state.config.components.find(c => c.id === 'tech-stack');
    if (component) {
      component.selectedStacks = techInfo.technologies;
      const stackList = techInfo.technologies.join(', ');
      component.content = `Technology stack: ${stackList}\n\nPlease provide solutions and examples specific to these technologies.`;
      component.enabled = true;
      renderComponents();
      updatePreview();
      saveConfig();
    }
  }

  function showPersonaModal(componentId) {
    const modal = document.getElementById('persona-modal');
    const grid = document.getElementById('personas-grid');

    const component = state.config.components.find(c => c.id === componentId);
    const selectedPersona = component?.selectedPersona || 'senior-engineer';

    grid.innerHTML = PERSONAS.map(persona => `
      <div class="persona-card ${persona.id === selectedPersona ? 'selected' : ''}" data-persona="${persona.id}">
        <div class="persona-name">${persona.name}</div>
        <div class="persona-description">${persona.description}</div>
      </div>
    `).join('');

    grid.addEventListener('click', (e) => {
      const card = e.target.closest('.persona-card');
      if (card) {
        const personaId = card.dataset.persona;
        selectPersona(componentId, personaId);
        closeModal();
      }
    });

    state.currentModal = { type: 'persona', componentId };
    modal.classList.add('show');
  }

  function showTechStackModal(componentId) {
    const modal = document.getElementById('techstack-modal');
    const grid = document.getElementById('techstack-grid');

    const component = state.config.components.find(c => c.id === componentId);
    const selectedStacks = component?.selectedStacks || [];

    renderTechStackGrid(grid, selectedStacks);

    grid.addEventListener('click', (e) => {
      const item = e.target.closest('.techstack-item');
      if (item) {
        const tech = item.dataset.tech;
        toggleTechStack(componentId, tech);
      }
    });

    state.currentModal = { type: 'techstack', componentId };
    modal.classList.add('show');
  }

  function renderTechStackGrid(grid, selectedStacks, filter = '') {
    let html = '';

    Object.entries(TECH_STACKS).forEach(([category, technologies]) => {
      const filtered = technologies.filter(tech =>
        tech.toLowerCase().includes(filter.toLowerCase())
      );

      if (filtered.length > 0) {
        filtered.forEach(tech => {
          const selected = selectedStacks.includes(tech) ? 'selected' : '';
          html += `<div class="techstack-item ${selected}" data-tech="${tech}">${tech}</div>`;
        });
      }
    });

    grid.innerHTML = html || '<p style="text-align: center; color: var(--text-secondary);">No technologies found</p>';
  }

  function filterTechStacks(query) {
    const component = state.config.components.find(c => c.id === state.currentModal?.componentId);
    const selectedStacks = component?.selectedStacks || [];
    const grid = document.getElementById('techstack-grid');
    renderTechStackGrid(grid, selectedStacks, query);
  }

  function selectPersona(componentId, personaId) {
    const component = state.config.components.find(c => c.id === componentId);
    const persona = PERSONAS.find(p => p.id === personaId);

    if (component && persona) {
      component.selectedPersona = personaId;
      component.content = persona.content;
      renderComponents();
      updatePreview();
      saveConfig();
      showStatus(`Persona changed to: ${persona.name}`, 'success');
    }
  }

  function toggleTechStack(componentId, tech) {
    const component = state.config.components.find(c => c.id === componentId);
    if (!component) return;

    if (!component.selectedStacks) {
      component.selectedStacks = [];
    }

    const index = component.selectedStacks.indexOf(tech);
    if (index > -1) {
      component.selectedStacks.splice(index, 1);
    } else {
      component.selectedStacks.push(tech);
    }

    // Update content
    const stackList = component.selectedStacks.join(', ') || '{{tech_stack}}';
    component.content = `Technology stack: ${stackList}\n\nPlease provide solutions and examples specific to these technologies.`;

    // Re-render grid
    const grid = document.getElementById('techstack-grid');
    renderTechStackGrid(grid, component.selectedStacks);

    renderComponents();
    updatePreview();
    saveConfig();
  }

  function closeModal() {
    document.querySelectorAll('.modal').forEach(modal => {
      modal.classList.remove('show');
    });
    state.currentModal = null;
  }

  function renderComponents() {
    const list = document.getElementById('components-list');
    const components = state.config.components.sort((a, b) => a.order - b.order);

    list.innerHTML = components.map(comp => {
      let badge = '';
      if (comp.id === 'role' && comp.selectedPersona) {
        const persona = PERSONAS.find(p => p.id === comp.selectedPersona);
        badge = `<span class="component-badge">${persona?.name || 'Default'}</span>`;
      } else if (comp.id === 'tech-stack' && comp.selectedStacks?.length > 0) {
        badge = `<span class="component-badge">${comp.selectedStacks.length} selected</span>`;
      }

      return `
        <div class="component-item ${comp.enabled ? 'active' : ''} ${comp.hasOptions ? 'has-options' : ''}" data-id="${comp.id}">
          <div class="component-header">
            <div class="component-toggle ${comp.enabled ? 'checked' : ''}" data-action="toggle"></div>
            <div class="component-name">${comp.name}</div>
            ${badge}
            <div class="component-actions">
              <button class="component-action" data-action="edit" title="Edit">‚úèÔ∏è</button>
              <button class="component-action" data-action="move-up" title="Move Up">‚Üë</button>
              <button class="component-action" data-action="move-down" title="Move Down">‚Üì</button>
              <button class="component-action" data-action="delete" title="Delete">üóëÔ∏è</button>
            </div>
          </div>
          <div class="component-body">
            ${comp.hasOptions ? renderComponentOptions(comp) : ''}
            <textarea data-id="${comp.id}" placeholder="Enter content for ${comp.name}...">${comp.content || ''}</textarea>
            <div class="component-meta">
              <span>${(comp.content || '').length} characters</span>
              <span>${(comp.content || '').split(/\s+/).filter(w => w).length} words</span>
            </div>
          </div>
        </div>
      `;
    }).join('');
  }

  function renderComponentOptions(comp) {
    if (comp.id === 'role') {
      return '<button class="component-select-btn" data-action="select-persona">üìù Select Persona</button>';
    } else if (comp.id === 'tech-stack') {
      return '<button class="component-select-btn" data-action="select-techstack">üîß Select Technologies</button>';
    }
    return '';
  }

  function handleComponentClick(e) {
    const action = e.target.dataset.action;
    if (!action) return;

    const item = e.target.closest('.component-item');
    const id = item.dataset.id;
    const component = state.config.components.find(c => c.id === id);

    if (!component) return;

    switch (action) {
      case 'toggle':
        component.enabled = !component.enabled;
        renderComponents();
        updatePreview();
        saveConfig();
        break;

      case 'edit':
        item.classList.toggle('expanded');
        break;

      case 'select-persona':
        showPersonaModal(id);
        break;

      case 'select-techstack':
        showTechStackModal(id);
        break;

      case 'move-up':
        moveComponent(id, -1);
        break;

      case 'move-down':
        moveComponent(id, 1);
        break;

      case 'delete':
        if (confirm(`Delete component "${component.name}"?`)) {
          state.config.components = state.config.components.filter(c => c.id !== id);
          renderComponents();
          updatePreview();
          saveConfig();
          showStatus('Component deleted', 'info');
        }
        break;
    }
  }

  function handleComponentInput(e) {
    if (e.target.tagName === 'TEXTAREA') {
      const id = e.target.dataset.id;
      const component = state.config.components.find(c => c.id === id);
      if (component) {
        component.content = e.target.value;
        updatePreview();
        saveConfig();

        // Update meta info
        const meta = e.target.nextElementSibling;
        if (meta) {
          const chars = e.target.value.length;
          const words = e.target.value.split(/\s+/).filter(w => w).length;
          meta.innerHTML = `
            <span>${chars} characters</span>
            <span>${words} words</span>
          `;
        }
      }
    }
  }

  function moveComponent(id, direction) {
    const index = state.config.components.findIndex(c => c.id === id);
    if (index === -1) return;

    const newIndex = index + direction;
    if (newIndex < 0 || newIndex >= state.config.components.length) return;

    // Swap
    [state.config.components[index], state.config.components[newIndex]] =
    [state.config.components[newIndex], state.config.components[index]];

    // Update orders
    state.config.components.forEach((comp, idx) => {
      comp.order = idx + 1;
    });

    renderComponents();
    updatePreview();
    saveConfig();
  }

  function handleAddComponent() {
    const input = document.getElementById('new-component-name');
    const name = input.value.trim();

    if (!name) {
      showStatus('Please enter a component name', 'error');
      return;
    }

    const id = name.toLowerCase().replace(/[^a-z0-9]+/g, '-');

    if (state.config.components.find(c => c.id === id)) {
      showStatus('Component with this name already exists', 'error');
      return;
    }

    state.config.components.push({
      id,
      name,
      enabled: true,
      order: state.config.components.length + 1,
      content: ''
    });

    input.value = '';
    renderComponents();
    updatePreview();
    saveConfig();
    showStatus(`Component "${name}" added`, 'success');
  }

  function updatePreview() {
    const format = document.getElementById('export-format').value;
    const enabledComponents = state.config.components
      .filter(c => c.enabled && c.content)
      .sort((a, b) => a.order - b.order);

    let prompt = '';

    if (format === 'markdown') {
      prompt = enabledComponents
        .map(c => `# ${c.name}\n\n${c.content}`)
        .join('\n\n---\n\n');
    } else if (format === 'plain') {
      prompt = enabledComponents
        .map(c => `${c.name}:\n${c.content}`)
        .join('\n\n');
    } else {
      // Structured format (default)
      prompt = enabledComponents
        .map(c => {
          const separator = '='.repeat(c.name.length + 4);
          return `${separator}\n# ${c.name}\n${separator}\n\n${c.content}`;
        })
        .join('\n\n');
    }

    const textarea = document.getElementById('final-prompt');
    textarea.value = prompt;

    // Update stats
    const chars = prompt.length;
    const words = prompt.split(/\s+/).filter(w => w).length;
    const lines = prompt.split('\n').length;
    const placeholders = (prompt.match(/\{\{[^}]+\}\}/g) || []).length;

    document.getElementById('char-count').textContent = `${chars} characters`;
    document.getElementById('word-count').textContent = `${words} words`;
    document.getElementById('line-count').textContent = `${lines} lines`;
    document.getElementById('placeholder-count').textContent = `${placeholders} placeholders`;
  }

  function handleCopyPrompt() {
    const textarea = document.getElementById('final-prompt');
    textarea.select();
    document.execCommand('copy');
    showStatus('Prompt copied to clipboard!', 'success');
  }

  function handleSavePrompt() {
    const prompt = document.getElementById('final-prompt').value;
    if (!prompt) {
      showStatus('No prompt to save', 'error');
      return;
    }

    const format = document.getElementById('export-format').value;
    const extension = format === 'markdown' ? 'md' : 'txt';

    const blob = new Blob([prompt], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `ai-prompt-${Date.now()}.${extension}`;
    a.click();
    URL.revokeObjectURL(url);
    showStatus('Prompt saved to file', 'success');
  }

  function handleImportProjectFile() {
    document.getElementById('project-file-input').click();
  }

  function handleImportConfig() {
    const input = document.getElementById('file-input');
    input.onchange = (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (event) => {
        try {
          const config = JSON.parse(event.target.result);
          if (!config.components || !Array.isArray(config.components)) {
            throw new Error('Invalid configuration format');
          }
          state.config = config;
          renderComponents();
          updatePreview();
          saveConfig();
          showStatus('Configuration imported successfully', 'success');
        } catch (error) {
          showStatus(`Import failed: ${error.message}`, 'error');
        }
      };
      reader.readAsText(file);
      input.value = '';
    };
    input.click();
  }

  function handleExportConfig() {
    const json = JSON.stringify(state.config, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `prompt-config-${Date.now()}.json`;
    a.click();
    URL.revokeObjectURL(url);
    showStatus('Configuration exported', 'success');
  }

  function handleResetConfig() {
    if (confirm('Reset to default configuration? This will discard all changes.')) {
      state.config = JSON.parse(JSON.stringify(DEFAULT_CONFIG));
      renderComponents();
      updatePreview();
      saveConfig();
      showStatus('Configuration reset to defaults', 'info');
    }
  }

  function loadTemplate(templateId) {
    const template = TEMPLATES[templateId];
    if (!template) return;

    if (confirm(`Load "${template.name}" template? This will replace your current configuration.`)) {
      state.config.components = JSON.parse(JSON.stringify(template.components));
      renderComponents();
      updatePreview();
      saveConfig();
      showStatus(`Template "${template.name}" loaded`, 'success');
    }
  }

  function saveConfig() {
    try {
      localStorage.setItem('ai-prompt-builder-config', JSON.stringify(state.config));
    } catch (error) {
      console.error('Failed to save config:', error);
    }
  }

  function loadConfig() {
    try {
      const saved = localStorage.getItem('ai-prompt-builder-config');
      if (saved) {
        state.config = JSON.parse(saved);
      }
    } catch (error) {
      console.error('Failed to load config:', error);
    }
  }

  function showStatus(message, type = 'info') {
    const statusEl = document.getElementById('status-message');
    statusEl.textContent = message;
    statusEl.className = `status-message show ${type}`;

    setTimeout(() => {
      statusEl.classList.remove('show');
    }, 3000);
  }
</script>

</body>
</html>
