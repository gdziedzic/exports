<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quick Calc - DevChef Tool</title>
</head>
<body>

<!-- DevChef Manifest -->
<script type="devchef-manifest">
{
  "id": "quick-calc",
  "name": "Quick Calc",
  "category": "Dev",
  "description": "Programmer's calculator: expressions, base conversion, bit ops, units - the only tool you need",
  "version": "1.0.0"
}
</script>

<!-- Tool UI Template -->
<template id="tool-ui">
  <div class="tool-container">
    <div class="tool-header">
      <h2 class="tool-title">‚ö° Quick Calc</h2>
      <p class="tool-description">The only calculator a programmer needs: expressions, base conversion, bit operations, and more</p>
    </div>

    <div class="calc-layout">
      <div class="main-calc">
        <div class="expression-panel">
          <div class="input-section">
            <input type="text" id="calc-input" placeholder="Enter expression: 0xFF + 42, Math.pow(2,16), 1024*1024..." autofocus />
            <button id="calc-btn" class="primary-btn">Calculate</button>
            <button id="clear-btn" class="secondary-btn">Clear</button>
          </div>

          <div class="result-panel">
            <div class="result-label">Result:</div>
            <div id="result-display" class="result-value">0</div>
          </div>

          <div class="conversions">
            <div class="conv-item">
              <span class="conv-label">Decimal:</span>
              <span id="result-dec" class="conv-value">0</span>
            </div>
            <div class="conv-item">
              <span class="conv-label">Hexadecimal:</span>
              <span id="result-hex" class="conv-value">0x0</span>
            </div>
            <div class="conv-item">
              <span class="conv-label">Binary:</span>
              <span id="result-bin" class="conv-value">0b0</span>
            </div>
            <div class="conv-item">
              <span class="conv-label">Octal:</span>
              <span id="result-oct" class="conv-value">0o0</span>
            </div>
          </div>
        </div>

        <div class="quick-ops">
          <h4>‚ö° Quick Operations</h4>
          <div class="op-grid">
            <button class="quick-btn" data-op="Math.PI">œÄ</button>
            <button class="quick-btn" data-op="Math.E">e</button>
            <button class="quick-btn" data-op="Math.sqrt(">‚àö</button>
            <button class="quick-btn" data-op="Math.pow(2,">2^</button>
            <button class="quick-btn" data-op="Math.pow(">x^y</button>
            <button class="quick-btn" data-op="Math.log(">ln</button>
            <button class="quick-btn" data-op="Math.sin(">sin</button>
            <button class="quick-btn" data-op="Math.cos(">cos</button>
            <button class="quick-btn" data-op="0x">0x</button>
            <button class="quick-btn" data-op="0b">0b</button>
            <button class="quick-btn" data-op="<<"> &lt;&lt; </button>
            <button class="quick-btn" data-op=">>"> &gt;&gt; </button>
            <button class="quick-btn" data-op="&">&amp;</button>
            <button class="quick-btn" data-op="|">|</button>
            <button class="quick-btn" data-op="^">XOR</button>
            <button class="quick-btn" data-op="~">~</button>
          </div>
        </div>

        <div class="constants">
          <h4>üìê Common Constants</h4>
          <div class="const-grid">
            <button class="const-btn" data-value="1024">1 KB</button>
            <button class="const-btn" data-value="1048576">1 MB</button>
            <button class="const-btn" data-value="1073741824">1 GB</button>
            <button class="const-btn" data-value="256">8-bit max</button>
            <button class="const-btn" data-value="65536">16-bit max</button>
            <button class="const-btn" data-value="4294967296">32-bit max</button>
            <button class="const-btn" data-value="60">FPS 60</button>
            <button class="const-btn" data-value="16.666">Frame @60fps</button>
          </div>
        </div>
      </div>

      <div class="side-panel">
        <div class="bit-ops">
          <h4>üîß Bit Operations</h4>
          <div class="bit-input-group">
            <input type="text" id="bit-a" placeholder="Value A" />
            <input type="text" id="bit-b" placeholder="Value B" />
          </div>
          <div class="bit-results">
            <div class="bit-result-item">
              <span>A AND B:</span>
              <code id="bit-and">-</code>
            </div>
            <div class="bit-result-item">
              <span>A OR B:</span>
              <code id="bit-or">-</code>
            </div>
            <div class="bit-result-item">
              <span>A XOR B:</span>
              <code id="bit-xor">-</code>
            </div>
            <div class="bit-result-item">
              <span>NOT A:</span>
              <code id="bit-not-a">-</code>
            </div>
            <div class="bit-result-item">
              <span>A &lt;&lt; B:</span>
              <code id="bit-shl">-</code>
            </div>
            <div class="bit-result-item">
              <span>A &gt;&gt; B:</span>
              <code id="bit-shr">-</code>
            </div>
          </div>
        </div>

        <div class="unit-conv">
          <h4>üìè Unit Conversions</h4>
          <input type="number" id="unit-value" placeholder="Enter value..." />
          <select id="unit-type">
            <option value="bytes">Bytes ‚Üî KB/MB/GB</option>
            <option value="time">ms ‚Üî seconds/minutes</option>
            <option value="deg-rad">Degrees ‚Üî Radians</option>
            <option value="temp">Celsius ‚Üî Fahrenheit</option>
          </select>
          <div id="unit-results" class="unit-results"></div>
        </div>

        <div class="history">
          <div class="history-header">
            <h4>üìú History</h4>
            <button id="clear-history-btn" class="tiny-btn">Clear</button>
          </div>
          <div id="history-list" class="history-list"></div>
        </div>
      </div>
    </div>
  </div>
</template>

<!-- Tool Styles -->
<style>
  .calc-layout {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 20px;
    margin-bottom: 24px;
  }

  .main-calc,
  .side-panel {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .expression-panel,
  .quick-ops,
  .constants,
  .bit-ops,
  .unit-conv,
  .history {
    background: var(--bg-secondary);
    border-radius: 12px;
    padding: 20px;
  }

  .input-section {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }

  #calc-input {
    flex: 1;
    padding: 14px 16px;
    background: var(--bg-primary);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 16px;
    font-family: var(--font-mono);
    font-weight: 600;
  }

  #calc-input:focus {
    outline: none;
    border-color: var(--accent);
  }

  .primary-btn,
  .secondary-btn {
    padding: 14px 24px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .primary-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }

  .primary-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }

  .secondary-btn {
    background: var(--bg-tertiary);
    color: var(--text-primary);
  }

  .secondary-btn:hover {
    background: var(--border-color);
  }

  .result-panel {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
    padding: 24px;
    margin-bottom: 20px;
    text-align: center;
  }

  .result-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
  }

  .result-value {
    color: white;
    font-size: 42px;
    font-weight: 700;
    font-family: var(--font-mono);
    word-break: break-all;
  }

  .conversions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .conv-item {
    background: var(--bg-primary);
    border-radius: 8px;
    padding: 12px 16px;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .conv-label {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .conv-value {
    font-size: 16px;
    font-weight: 700;
    font-family: var(--font-mono);
    color: var(--text-primary);
    word-break: break-all;
  }

  h4 {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .op-grid,
  .const-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
  }

  .quick-btn,
  .const-btn {
    padding: 12px;
    background: var(--bg-primary);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .quick-btn:hover,
  .const-btn:hover {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
    transform: translateY(-2px);
  }

  .bit-input-group {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 16px;
  }

  .bit-input-group input,
  #unit-value {
    padding: 10px 12px;
    background: var(--bg-primary);
    border: 2px solid var(--border-color);
    border-radius: 6px;
    color: var(--text-primary);
    font-size: 13px;
    font-family: var(--font-mono);
  }

  #unit-type {
    width: 100%;
    padding: 10px 12px;
    margin: 8px 0 16px 0;
    background: var(--bg-primary);
    border: 2px solid var(--border-color);
    border-radius: 6px;
    color: var(--text-primary);
    font-size: 13px;
    font-weight: 600;
  }

  .bit-results,
  .unit-results {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .bit-result-item,
  .unit-result-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 12px;
    background: var(--bg-primary);
    border-radius: 6px;
    font-size: 13px;
  }

  .bit-result-item span,
  .unit-result-item span {
    color: var(--text-secondary);
    font-weight: 600;
  }

  .bit-result-item code,
  .unit-result-item code {
    color: var(--accent);
    font-family: var(--font-mono);
    font-weight: 700;
  }

  .history-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 14px;
  }

  .history-header h4 {
    margin: 0;
  }

  .tiny-btn {
    padding: 4px 10px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    color: var(--text-secondary);
    font-size: 11px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .tiny-btn:hover {
    background: var(--error);
    color: white;
    border-color: var(--error);
  }

  .history-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
    max-height: 300px;
    overflow-y: auto;
  }

  .history-item {
    padding: 10px 12px;
    background: var(--bg-primary);
    border-radius: 6px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
    border: 1px solid transparent;
  }

  .history-item:hover {
    border-color: var(--accent);
    background: var(--bg-tertiary);
  }

  .history-expr {
    color: var(--text-secondary);
    font-family: var(--font-mono);
    margin-bottom: 4px;
  }

  .history-result {
    color: var(--accent);
    font-family: var(--font-mono);
    font-weight: 700;
  }

  @media (max-width: 1200px) {
    .calc-layout {
      grid-template-columns: 1fr;
    }

    .op-grid {
      grid-template-columns: repeat(8, 1fr);
    }
  }
</style>

<!-- Standalone Styles -->
<style id="standalone-styles">
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  :root {
    --bg-primary: #ffffff;
    --bg-secondary: #f5f5f5;
    --bg-tertiary: #e0e0e0;
    --border-color: #d0d0d0;
    --text-primary: #2c3e50;
    --text-secondary: #7f8c8d;
    --accent: #667eea;
    --accent-hover: #5568d3;
    --error: #e74c3c;
    --font-mono: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
    --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  }

  body {
    font-family: var(--font-sans);
    background: var(--bg-primary);
    color: var(--text-primary);
    padding: 24px;
    line-height: 1.6;
  }

  .tool-container {
    max-width: 1600px;
    margin: 0 auto;
  }

  .tool-header {
    margin-bottom: 32px;
    padding-bottom: 16px;
    border-bottom: 2px solid var(--border-color);
  }

  .tool-title {
    font-size: 48px;
    font-weight: 900;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 8px;
  }

  .tool-description {
    font-size: 18px;
    color: var(--text-secondary);
    font-weight: 500;
  }

  button {
    font-family: var(--font-sans);
  }
</style>

<!-- Tool Module Logic -->
<script type="module">
export const DevChefTool = {
  container: null,
  context: null,
  history: [],

  init(container, context) {
    this.container = container;
    this.context = context;

    const calcInput = container.querySelector('#calc-input');
    const calcBtn = container.querySelector('#calc-btn');
    const clearBtn = container.querySelector('#clear-btn');

    // Main calculation
    calcBtn?.addEventListener('click', () => this.calculate());
    calcInput?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') this.calculate();
    });
    clearBtn?.addEventListener('click', () => this.clear());

    // Quick operations
    container.querySelectorAll('.quick-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const op = e.target.dataset.op;
        calcInput.value += op;
        calcInput.focus();
      });
    });

    // Constants
    container.querySelectorAll('.const-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const value = e.target.dataset.value;
        calcInput.value = value;
        this.calculate();
      });
    });

    // Bit operations
    const bitA = container.querySelector('#bit-a');
    const bitB = container.querySelector('#bit-b');
    bitA?.addEventListener('input', () => this.updateBitOps());
    bitB?.addEventListener('input', () => this.updateBitOps());

    // Unit conversions
    const unitValue = container.querySelector('#unit-value');
    const unitType = container.querySelector('#unit-type');
    unitValue?.addEventListener('input', () => this.updateUnitConv());
    unitType?.addEventListener('change', () => this.updateUnitConv());

    // History
    container.querySelector('#clear-history-btn')?.addEventListener('click', () => this.clearHistory());

    // Load history from localStorage
    this.loadHistory();
  },

  calculate() {
    const input = this.container.querySelector('#calc-input').value.trim();
    if (!input) return;

    try {
      // Support for common programming notations
      let expr = input
        .replace(/0x([0-9a-fA-F]+)/g, 'parseInt("$1", 16)')
        .replace(/0b([01]+)/g, 'parseInt("$1", 2)')
        .replace(/0o([0-7]+)/g, 'parseInt("$1", 8)');

      // Evaluate safely (in production, use a proper expression parser)
      const result = Function('"use strict"; return (' + expr + ')')();

      this.displayResult(result);
      this.addToHistory(input, result);
    } catch (err) {
      this.container.querySelector('#result-display').textContent = 'Error: ' + err.message;
    }
  },

  displayResult(result) {
    const resultDisplay = this.container.querySelector('#result-display');
    const resultDec = this.container.querySelector('#result-dec');
    const resultHex = this.container.querySelector('#result-hex');
    const resultBin = this.container.querySelector('#result-bin');
    const resultOct = this.container.querySelector('#result-oct');

    resultDisplay.textContent = result;

    if (typeof result === 'number' && Number.isFinite(result)) {
      const intResult = Math.floor(result);
      resultDec.textContent = result.toString();
      resultHex.textContent = '0x' + intResult.toString(16).toUpperCase();
      resultBin.textContent = '0b' + intResult.toString(2);
      resultOct.textContent = '0o' + intResult.toString(8);
    } else {
      resultDec.textContent = '-';
      resultHex.textContent = '-';
      resultBin.textContent = '-';
      resultOct.textContent = '-';
    }

    this.context.setOutput(result.toString());
  },

  clear() {
    this.container.querySelector('#calc-input').value = '';
    this.displayResult(0);
  },

  updateBitOps() {
    const aStr = this.container.querySelector('#bit-a').value.trim();
    const bStr = this.container.querySelector('#bit-b').value.trim();

    if (!aStr || !bStr) return;

    try {
      const a = this.parseNumber(aStr);
      const b = this.parseNumber(bStr);

      this.container.querySelector('#bit-and').textContent = (a & b).toString() + ' (0x' + (a & b).toString(16).toUpperCase() + ')';
      this.container.querySelector('#bit-or').textContent = (a | b).toString() + ' (0x' + (a | b).toString(16).toUpperCase() + ')';
      this.container.querySelector('#bit-xor').textContent = (a ^ b).toString() + ' (0x' + (a ^ b).toString(16).toUpperCase() + ')';
      this.container.querySelector('#bit-not-a').textContent = (~a).toString() + ' (0x' + (~a >>> 0).toString(16).toUpperCase() + ')';
      this.container.querySelector('#bit-shl').textContent = (a << b).toString() + ' (0x' + (a << b).toString(16).toUpperCase() + ')';
      this.container.querySelector('#bit-shr').textContent = (a >> b).toString() + ' (0x' + (a >> b).toString(16).toUpperCase() + ')';
    } catch (err) {
      // Ignore parsing errors
    }
  },

  parseNumber(str) {
    if (str.startsWith('0x')) return parseInt(str.substring(2), 16);
    if (str.startsWith('0b')) return parseInt(str.substring(2), 2);
    if (str.startsWith('0o')) return parseInt(str.substring(2), 8);
    return parseInt(str, 10);
  },

  updateUnitConv() {
    const value = parseFloat(this.container.querySelector('#unit-value').value);
    const type = this.container.querySelector('#unit-type').value;
    const resultsDiv = this.container.querySelector('#unit-results');

    if (isNaN(value)) {
      resultsDiv.innerHTML = '';
      return;
    }

    let html = '';

    switch (type) {
      case 'bytes':
        html = `
          <div class="unit-result-item"><span>Bytes:</span> <code>${value.toLocaleString()}</code></div>
          <div class="unit-result-item"><span>KB:</span> <code>${(value / 1024).toFixed(2)}</code></div>
          <div class="unit-result-item"><span>MB:</span> <code>${(value / 1048576).toFixed(2)}</code></div>
          <div class="unit-result-item"><span>GB:</span> <code>${(value / 1073741824).toFixed(2)}</code></div>
        `;
        break;
      case 'time':
        html = `
          <div class="unit-result-item"><span>Milliseconds:</span> <code>${value}</code></div>
          <div class="unit-result-item"><span>Seconds:</span> <code>${(value / 1000).toFixed(3)}</code></div>
          <div class="unit-result-item"><span>Minutes:</span> <code>${(value / 60000).toFixed(3)}</code></div>
          <div class="unit-result-item"><span>Hours:</span> <code>${(value / 3600000).toFixed(3)}</code></div>
        `;
        break;
      case 'deg-rad':
        html = `
          <div class="unit-result-item"><span>Degrees:</span> <code>${value}¬∞</code></div>
          <div class="unit-result-item"><span>Radians:</span> <code>${(value * Math.PI / 180).toFixed(6)}</code></div>
        `;
        break;
      case 'temp':
        html = `
          <div class="unit-result-item"><span>Celsius:</span> <code>${value}¬∞C</code></div>
          <div class="unit-result-item"><span>Fahrenheit:</span> <code>${(value * 9/5 + 32).toFixed(2)}¬∞F</code></div>
          <div class="unit-result-item"><span>Kelvin:</span> <code>${(value + 273.15).toFixed(2)}K</code></div>
        `;
        break;
    }

    resultsDiv.innerHTML = html;
  },

  addToHistory(expr, result) {
    this.history.unshift({ expr, result });
    if (this.history.length > 20) this.history.pop();
    this.saveHistory();
    this.renderHistory();
  },

  renderHistory() {
    const historyList = this.container.querySelector('#history-list');
    if (!historyList) return;

    historyList.innerHTML = this.history.map((item, index) => `
      <div class="history-item" data-index="${index}">
        <div class="history-expr">${this.escapeHtml(item.expr)}</div>
        <div class="history-result">= ${this.escapeHtml(String(item.result))}</div>
      </div>
    `).join('');

    // Add click handlers
    historyList.querySelectorAll('.history-item').forEach(item => {
      item.addEventListener('click', (e) => {
        const index = parseInt(e.currentTarget.dataset.index);
        const historyItem = this.history[index];
        this.container.querySelector('#calc-input').value = historyItem.expr;
        this.displayResult(historyItem.result);
      });
    });
  },

  clearHistory() {
    this.history = [];
    this.saveHistory();
    this.renderHistory();
  },

  saveHistory() {
    try {
      localStorage.setItem('quick-calc-history', JSON.stringify(this.history));
    } catch (e) {
      // Ignore localStorage errors
    }
  },

  loadHistory() {
    try {
      const saved = localStorage.getItem('quick-calc-history');
      if (saved) {
        this.history = JSON.parse(saved);
        this.renderHistory();
      }
    } catch (e) {
      // Ignore localStorage errors
    }
  },

  escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  },

  onInput(input, context) {
    return { output: "" };
  }
};

// Standalone mode initialization
if (typeof window !== 'undefined' && !window.DevChef) {
  document.addEventListener('DOMContentLoaded', () => {
    const isStandalone = !document.querySelector('#workspace');

    if (isStandalone) {
      const standaloneContext = {
        input: "",
        output: "",
        setInput(val) { this.input = val; },
        setOutput(val) { this.output = val; },
        getInput() { return this.input; },
        getOutput() { return this.output; }
      };

      const template = document.querySelector('#tool-ui');
      if (template) {
        document.body.innerHTML = template.innerHTML;
        DevChefTool.init(document.body, standaloneContext);
      }
    }
  });
}
</script>

</body>
</html>
