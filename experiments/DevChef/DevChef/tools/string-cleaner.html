<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>String Cleaner - DevChef Tool</title>
</head>
<body>

<!-- DevChef Manifest -->
<script type="devchef-manifest">
{
  "id": "string-cleaner",
  "name": "String Cleaner",
  "category": "Text",
  "description": "Clean, trim, and transform text strings",
  "version": "1.0.0"
}
</script>

<!-- Tool UI Template -->
<template id="tool-ui">
  <div class="tool-container">
    <div class="tool-header">
      <h2 class="tool-title">String Cleaner</h2>
      <p class="tool-description">Clean, trim, and transform text with various operations</p>
    </div>

    <div class="tool-section">
      <label class="section-label" for="input">Input Text</label>
      <textarea id="input" placeholder="Paste text here..."></textarea>
    </div>

    <div class="tool-section">
      <label class="section-label">Operations</label>
      <div class="operations-grid">
        <label class="operation-item">
          <input type="checkbox" id="op-trim" checked>
          <span>Trim whitespace</span>
        </label>
        <label class="operation-item">
          <input type="checkbox" id="op-lowercase">
          <span>Lowercase</span>
        </label>
        <label class="operation-item">
          <input type="checkbox" id="op-uppercase">
          <span>Uppercase</span>
        </label>
        <label class="operation-item">
          <input type="checkbox" id="op-remove-extra-spaces">
          <span>Remove extra spaces</span>
        </label>
        <label class="operation-item">
          <input type="checkbox" id="op-remove-newlines">
          <span>Remove newlines</span>
        </label>
        <label class="operation-item">
          <input type="checkbox" id="op-remove-special">
          <span>Remove special chars</span>
        </label>
        <label class="operation-item">
          <input type="checkbox" id="op-remove-numbers">
          <span>Remove numbers</span>
        </label>
        <label class="operation-item">
          <input type="checkbox" id="op-title-case">
          <span>Title Case</span>
        </label>
      </div>
    </div>

    <div class="tool-section">
      <label class="section-label" for="output">Cleaned Text</label>
      <textarea id="output" readonly></textarea>
      <div id="stats" class="stats"></div>
    </div>

    <div class="tool-section">
      <button id="copy-btn">Copy Result</button>
      <button id="clear-btn" class="secondary">Clear</button>
    </div>
  </div>
</template>

<!-- Tool Styles -->
<style>
  .operations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 12px;
    margin-bottom: 16px;
  }

  .operation-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    cursor: pointer;
    user-select: none;
  }

  .operation-item input[type="checkbox"] {
    width: auto;
    cursor: pointer;
  }

  .operation-item:hover {
    color: var(--accent-hover);
  }

  .stats {
    margin-top: 8px;
    font-size: 12px;
    color: var(--text-secondary);
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 8px;
  }

  .stat-item {
    padding: 8px;
    background: var(--bg-secondary);
    border-radius: 4px;
  }

  .stat-label {
    color: var(--text-secondary);
    font-size: 11px;
  }

  .stat-value {
    color: var(--text-primary);
    font-weight: 600;
    margin-top: 4px;
  }

  #output {
    min-height: 150px;
  }
</style>

<!-- Standalone Styles (used when opened directly) -->
<style id="standalone-styles">
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  :root {
    --bg-primary: #ffffff;
    --bg-secondary: #f5f5f5;
    --bg-tertiary: #e0e0e0;
    --border-color: #d0d0d0;
    --text-primary: #2c3e50;
    --text-secondary: #7f8c8d;
    --accent: #3498db;
    --accent-hover: #2980b9;
    --success: #27ae60;
    --error: #e74c3c;
    --warning: #f39c12;
    --font-mono: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
    --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  }

  body {
    font-family: var(--font-sans);
    background: var(--bg-primary);
    color: var(--text-primary);
    padding: 24px;
    line-height: 1.6;
  }

  .tool-container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .tool-header {
    margin-bottom: 32px;
    padding-bottom: 16px;
    border-bottom: 2px solid var(--border-color);
  }

  .tool-title {
    font-size: 32px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
  }

  .tool-description {
    font-size: 16px;
    color: var(--text-secondary);
  }

  .tool-section {
    margin-bottom: 24px;
  }

  .section-label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  textarea,
  input[type="text"],
  select {
    width: 100%;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    padding: 12px;
    font-family: var(--font-mono);
    font-size: 14px;
    border-radius: 6px;
    resize: vertical;
    transition: all 0.2s;
  }

  textarea:focus,
  input:focus,
  select:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
  }

  textarea {
    min-height: 150px;
  }

  button {
    background: var(--accent);
    color: white;
    border: none;
    padding: 12px 24px;
    font-size: 14px;
    font-weight: 500;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
    font-family: var(--font-sans);
    margin-right: 8px;
  }

  button:hover {
    background: var(--accent-hover);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  button:active {
    transform: translateY(0);
  }

  button.secondary {
    background: var(--bg-tertiary);
    color: var(--text-primary);
  }

  button.secondary:hover {
    background: var(--border-color);
  }

  input[type="checkbox"] {
    width: auto;
    cursor: pointer;
  }

  select {
    width: auto;
  }
</style>

<!-- Tool Module Logic -->
<script type="module">
export const DevChefTool = {
  container: null,
  context: null,

  init(container, context) {
    this.container = container;
    this.context = context;

    // Get elements
    const inputEl = container.querySelector("#input");
    const copyBtn = container.querySelector("#copy-btn");
    const clearBtn = container.querySelector("#clear-btn");

    // Set up input handler
    if (inputEl) {
      inputEl.addEventListener("input", (e) => {
        context.setInput(e.target.value);
      });
    }

    // Set up operation checkboxes
    const checkboxes = container.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
      checkbox.addEventListener("change", () => {
        if (context.input) {
          context.setInput(context.input);
        }
      });
    });

    // Copy button
    if (copyBtn) {
      copyBtn.addEventListener("click", () => {
        this.copyToClipboard();
      });
    }

    // Clear button
    if (clearBtn) {
      clearBtn.addEventListener("click", () => {
        context.setInput("");
        context.setOutput("");
        inputEl.value = "";
        this.updateStats("", "");
      });
    }
  },

  onInput(input, context) {
    let result = input;

    // Apply operations based on checkboxes
    const ops = {
      trim: this.container.querySelector("#op-trim")?.checked,
      lowercase: this.container.querySelector("#op-lowercase")?.checked,
      uppercase: this.container.querySelector("#op-uppercase")?.checked,
      removeExtraSpaces: this.container.querySelector("#op-remove-extra-spaces")?.checked,
      removeNewlines: this.container.querySelector("#op-remove-newlines")?.checked,
      removeSpecial: this.container.querySelector("#op-remove-special")?.checked,
      removeNumbers: this.container.querySelector("#op-remove-numbers")?.checked,
      titleCase: this.container.querySelector("#op-title-case")?.checked
    };

    // Trim
    if (ops.trim) {
      result = result.trim();
    }

    // Remove extra spaces
    if (ops.removeExtraSpaces) {
      result = result.replace(/\s+/g, ' ');
    }

    // Remove newlines
    if (ops.removeNewlines) {
      result = result.replace(/\n/g, ' ');
    }

    // Remove special characters
    if (ops.removeSpecial) {
      result = result.replace(/[^a-zA-Z0-9\s]/g, '');
    }

    // Remove numbers
    if (ops.removeNumbers) {
      result = result.replace(/[0-9]/g, '');
    }

    // Case transformations (mutually exclusive, last one wins)
    if (ops.lowercase) {
      result = result.toLowerCase();
    }

    if (ops.uppercase) {
      result = result.toUpperCase();
    }

    if (ops.titleCase) {
      result = result.toLowerCase().replace(/\b\w/g, char => char.toUpperCase());
    }

    // Update stats
    this.updateStats(input, result);

    return { output: result };
  },

  updateStats(input, output) {
    const stats = this.container.querySelector("#stats");
    if (!stats) return;

    const inputLength = input.length;
    const outputLength = output.length;
    const inputWords = input.trim() ? input.trim().split(/\s+/).length : 0;
    const outputWords = output.trim() ? output.trim().split(/\s+/).length : 0;
    const inputLines = input ? input.split('\n').length : 0;
    const outputLines = output ? output.split('\n').length : 0;

    stats.innerHTML = `
      <div class="stat-item">
        <div class="stat-label">Characters</div>
        <div class="stat-value">${inputLength} → ${outputLength}</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Words</div>
        <div class="stat-value">${inputWords} → ${outputWords}</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Lines</div>
        <div class="stat-value">${inputLines} → ${outputLines}</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Reduction</div>
        <div class="stat-value">${inputLength > 0 ? Math.round((1 - outputLength / inputLength) * 100) : 0}%</div>
      </div>
    `;
  },

  copyToClipboard() {
    const output = this.context.getOutput();
    if (output) {
      navigator.clipboard.writeText(output).then(() => {
        const copyBtn = this.container.querySelector("#copy-btn");
        const originalText = copyBtn.textContent;
        copyBtn.textContent = "✓ Copied!";
        setTimeout(() => {
          copyBtn.textContent = originalText;
        }, 2000);
      }).catch(err => {
        console.error("Failed to copy:", err);
      });
    }
  }
};

// Standalone mode initialization
if (typeof window !== 'undefined' && !window.DevChef) {
  document.addEventListener('DOMContentLoaded', () => {
    // Check if we're running standalone (not inside DevChef)
    const isStandalone = !document.querySelector('#workspace');

    if (isStandalone) {
      // Create standalone context
      const standaloneContext = {
        input: "",
        output: "",
        setInput(val) {
          this.input = val;
          if (this.onInputChanged) {
            this.onInputChanged(val);
          }
        },
        setOutput(val) {
          this.output = val;
          const outputEl = document.querySelector("#output");
          if (outputEl) outputEl.value = val;
        },
        getInput() { return this.input; },
        getOutput() { return this.output; },
        onInputChanged: null
      };

      // Inject template into body
      const template = document.querySelector('#tool-ui');
      if (template) {
        document.body.innerHTML = template.innerHTML;

        // Initialize tool
        DevChefTool.init(document.body, standaloneContext);

        // Set up input change handler
        standaloneContext.onInputChanged = (input) => {
          const result = DevChefTool.onInput(input, standaloneContext);
          if (result && result.output !== undefined) {
            standaloneContext.setOutput(result.output);
          }
        };
      }
    }
  });
}
</script>

</body>
</html>
