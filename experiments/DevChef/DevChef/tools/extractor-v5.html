<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Extractor V5 Ultimate - DevChef Tool</title>
</head>
<body>

<!-- DevChef Manifest -->
<script type="devchef-manifest">
{
  "id": "extractor-v5",
  "name": "Extractor V5 Ultimate",
  "category": "Text",
  "description": "Ultimate extraction tool with fixed tests, scrollable results, enhanced search, and 60+ validated patterns",
  "version": "5.0.0",
  "keywords": ["extract", "regex", "test", "validate", "search", "ultimate"]
}
</script>

<!-- Tool UI Template -->
<template id="tool-ui">
  <div class="tool-container">
    <div class="tool-header">
      <h2 class="tool-title">üöÄ Extractor V5 Ultimate</h2>
      <p class="tool-description">Advanced extraction with fixed tests, scrollable results & enhanced pattern search</p>
    </div>

    <!-- Quick Actions Bar -->
    <div class="quick-actions">
      <button class="quick-btn" id="run-tests-btn" title="Run All Tests">
        üß™ Run Tests
      </button>
      <button class="quick-btn" id="load-test-data-btn" title="Load Test Data">
        üìù Test Data
      </button>
      <button class="quick-btn" id="validate-patterns-btn" title="Validate Patterns">
        ‚úÖ Validate
      </button>
      <button class="quick-btn" id="pattern-tester-btn" title="Pattern Tester">
        üî¨ Tester
      </button>
      <button class="quick-btn" id="load-preset-btn" title="Load Preset">
        üìö Presets
      </button>
      <button class="quick-btn" id="performance-btn" title="Performance Test">
        ‚ö° Performance
      </button>
    </div>

    <!-- Main Layout -->
    <div class="main-layout">
      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Test Status -->
        <div class="section-card">
          <div class="section-header">
            <h3>üß™ Test Status</h3>
          </div>
          <div class="test-status">
            <div class="status-item">
              <span class="status-label">Total Tests:</span>
              <span class="status-value" id="total-tests">0</span>
            </div>
            <div class="status-item">
              <span class="status-label">Passed:</span>
              <span class="status-value success" id="passed-tests">0</span>
            </div>
            <div class="status-item">
              <span class="status-label">Failed:</span>
              <span class="status-value error" id="failed-tests">0</span>
            </div>
            <div class="status-item">
              <span class="status-label">Coverage:</span>
              <span class="status-value" id="test-coverage">0%</span>
            </div>
          </div>
        </div>

        <!-- Pattern Search -->
        <div class="section-card">
          <div class="section-header">
            <h3>üîç Pattern Search</h3>
          </div>
          <input type="text" id="sidebar-pattern-search" placeholder="Search patterns..." class="sidebar-search-input" />
          <div class="search-stats">
            <span id="search-results-count">60 patterns</span>
          </div>
        </div>

        <!-- Pattern Stats -->
        <div class="section-card">
          <div class="section-header">
            <h3>üìä Pattern Stats</h3>
          </div>
          <div class="pattern-stats">
            <div class="stat-pill">
              <span class="stat-label">Enabled:</span>
              <span class="stat-value" id="enabled-count">0</span>
            </div>
            <div class="stat-pill">
              <span class="stat-label">Matches:</span>
              <span class="stat-value" id="matches-count">0</span>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="section-card">
          <button class="action-btn primary" id="extract-btn">
            ‚ö° Extract Patterns
          </button>
          <div class="action-row">
            <button class="action-btn secondary" id="select-all-btn">‚òë All</button>
            <button class="action-btn secondary" id="clear-all-btn">‚òê None</button>
            <button class="action-btn secondary" id="invert-btn">üîÑ Invert</button>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Tab Navigation -->
        <div class="tabs">
          <button class="tab active" data-tab="extract">Extract</button>
          <button class="tab" data-tab="patterns">Patterns (60+)</button>
          <button class="tab" data-tab="tests">Tests</button>
          <button class="tab" data-tab="tester">Pattern Tester</button>
          <button class="tab" data-tab="testdata">Test Data</button>
          <button class="tab" data-tab="analytics">Analytics</button>
        </div>

        <!-- Extract Tab -->
        <div class="tab-panel active" id="extract-panel">
          <div class="io-layout">
            <div class="io-section">
              <div class="io-header">
                <div class="io-title">
                  <span class="io-icon">üì•</span>
                  <h4>Input</h4>
                </div>
                <div class="io-actions">
                  <button class="btn-icon-sm" id="paste-btn" title="Paste">üìã</button>
                  <button class="btn-icon-sm" id="clear-input-btn" title="Clear">üóëÔ∏è</button>
                </div>
              </div>
              <div class="textarea-wrapper">
                <textarea id="input-text" placeholder="Paste or type your text here...

üß™ Click 'Test Data' to load sample data
üî¨ Use Pattern Tester to validate regex
‚ö° Click 'Run Tests' to validate all patterns

Try pasting: URLs, emails, crypto addresses, API keys, logs, code..."></textarea>
                <div class="char-counter">
                  <span id="char-count">0</span> chars | <span id="line-count">0</span> lines
                </div>
              </div>
            </div>

            <div class="io-section">
              <div class="io-header">
                <div class="io-title">
                  <span class="io-icon">üì§</span>
                  <h4>Results</h4>
                </div>
                <div class="io-actions">
                  <select id="view-mode" class="view-select">
                    <option value="grouped">Grouped</option>
                    <option value="flat">Flat List</option>
                    <option value="json">JSON</option>
                    <option value="csv">CSV</option>
                  </select>
                  <button class="btn-icon-sm" id="copy-btn" title="Copy">üìã</button>
                  <button class="btn-icon-sm" id="download-btn" title="Download">üíæ</button>
                </div>
              </div>
              <div class="results-wrapper-fixed">
                <div id="results-container">
                  <div class="empty-state">
                    <div class="empty-icon">üéØ</div>
                    <h3>Ready to Extract</h3>
                    <p>Select patterns and click "Extract Patterns" to begin</p>
                  </div>
                </div>
              </div>
              <div class="results-footer">
                <label class="toggle-option">
                  <input type="checkbox" id="dedupe-toggle" checked />
                  <span>Remove duplicates</span>
                </label>
                <label class="toggle-option">
                  <input type="checkbox" id="sort-toggle" />
                  <span>Sort results</span>
                </label>
                <div class="results-stats">
                  Found: <strong id="total-found">0</strong> | Unique: <strong id="unique-found">0</strong>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Patterns Tab -->
        <div class="tab-panel" id="patterns-panel">
          <div class="patterns-controls">
            <input type="text" id="pattern-search" placeholder="üîç Search patterns by name or description..." class="search-input" />
            <select id="category-filter" class="filter-select">
              <option value="">All Categories</option>
              <option value="web">üåê Web & Network</option>
              <option value="security">üîê Security</option>
              <option value="crypto">‚Çø Crypto</option>
              <option value="identifiers">üÜî Identifiers</option>
              <option value="dates">üìÖ Dates & Time</option>
              <option value="contact">üìû Contact</option>
              <option value="financial">üí∞ Financial</option>
              <option value="code">üíª Code</option>
              <option value="logs">üìä Logs</option>
              <option value="text">üìù Text</option>
              <option value="numbers">üî¢ Numbers</option>
              <option value="paths">üìÅ Paths</option>
            </select>
            <button class="filter-select" id="clear-search-btn" style="cursor: pointer;">Clear Search</button>
          </div>
          <div class="patterns-grid" id="patterns-grid"></div>
        </div>

        <!-- Tests Tab -->
        <div class="tab-panel" id="tests-panel">
          <div class="tests-header">
            <h3>üß™ Pattern Tests</h3>
            <div class="tests-controls">
              <button class="action-btn secondary" id="run-all-tests-btn">‚ñ∂Ô∏è Run All Tests</button>
              <button class="action-btn secondary" id="export-tests-btn">üíæ Export Results</button>
            </div>
          </div>
          <div class="test-results-wrapper">
            <div id="test-results">
              <div class="empty-state">
                <div class="empty-icon">üß™</div>
                <h3>Test Suite Ready</h3>
                <p>Click "Run All Tests" to validate all patterns</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Pattern Tester Tab -->
        <div class="tab-panel" id="tester-panel">
          <div class="pattern-tester">
            <div class="tester-section">
              <h4>üî¨ Pattern Tester</h4>
              <p class="hint-text">Test and validate regex patterns in real-time</p>

              <div class="tester-input-group">
                <label>Pattern Name:</label>
                <input type="text" id="tester-name" placeholder="My Pattern" class="tester-input" />
              </div>

              <div class="tester-input-group">
                <label>Regex Pattern:</label>
                <input type="text" id="tester-regex" placeholder="e.g., \b\d{3}-\d{2}-\d{4}\b" class="tester-input" />
              </div>

              <div class="tester-input-group">
                <label>Flags:</label>
                <div class="flag-options">
                  <label><input type="checkbox" id="flag-g" checked /> g (global)</label>
                  <label><input type="checkbox" id="flag-i" /> i (case-insensitive)</label>
                  <label><input type="checkbox" id="flag-m" /> m (multiline)</label>
                </div>
              </div>

              <div class="tester-input-group">
                <label>Test Input:</label>
                <textarea id="tester-input" placeholder="Paste test input here..." rows="8" class="tester-textarea"></textarea>
              </div>

              <button class="action-btn primary" id="test-pattern-btn">üî¨ Test Pattern</button>
            </div>

            <div class="tester-results-section">
              <h4>üìä Test Results</h4>
              <div id="tester-results" class="tester-results">
                <div class="empty-state">
                  <p>Results will appear here</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Test Data Tab -->
        <div class="tab-panel" id="testdata-panel">
          <div class="testdata-header">
            <h3>üìù Test Data Library</h3>
            <p class="hint-text">Sample data sets for testing pattern extraction</p>
          </div>
          <div class="testdata-grid" id="testdata-grid"></div>
        </div>

        <!-- Analytics Tab -->
        <div class="tab-panel" id="analytics-panel">
          <div class="analytics-grid">
            <div class="stat-card-large">
              <div class="stat-icon">üéØ</div>
              <div class="stat-content">
                <div class="stat-value" id="analytics-total">0</div>
                <div class="stat-label">Total Matches</div>
              </div>
            </div>
            <div class="stat-card-large">
              <div class="stat-icon">‚ú®</div>
              <div class="stat-content">
                <div class="stat-value" id="analytics-unique">0</div>
                <div class="stat-label">Unique Items</div>
              </div>
            </div>
            <div class="stat-card-large">
              <div class="stat-icon">üìä</div>
              <div class="stat-content">
                <div class="stat-value" id="analytics-types">0</div>
                <div class="stat-label">Pattern Types</div>
              </div>
            </div>
            <div class="stat-card-large">
              <div class="stat-icon">‚ö°</div>
              <div class="stat-content">
                <div class="stat-value" id="analytics-perf">0ms</div>
                <div class="stat-label">Extraction Time</div>
              </div>
            </div>
          </div>

          <div class="chart-section">
            <h3>üìà Pattern Distribution</h3>
            <div id="distribution-chart"></div>
          </div>

          <div class="insights-section">
            <h3>üí° Insights</h3>
            <div id="insights-list"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="preset-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>üìö Pattern Presets</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body" id="preset-modal-body"></div>
      </div>
    </div>

    <div class="modal" id="performance-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>‚ö° Performance Test Results</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body" id="performance-modal-body"></div>
      </div>
    </div>
  </div>
</template>

<!-- Tool Styles -->
<style>
  :root {
    --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --primary-solid: #667eea;
    --secondary: #6c757d;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --info: #3b82f6;
    --bg-base: #ffffff;
    --bg-elevated: #f8fafc;
    --bg-hover: #f1f5f9;
    --border: #e2e8f0;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
  }

  .tool-container {
    max-width: 100%;
    margin: 0 auto;
  }

  .tool-header {
    margin-bottom: 24px;
    padding-bottom: 20px;
    border-bottom: 3px solid transparent;
    border-image: var(--primary) 1;
  }

  .tool-title {
    font-size: 42px;
    font-weight: 800;
    background: var(--primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 8px;
    letter-spacing: -0.02em;
  }

  .tool-description {
    font-size: 16px;
    color: var(--text-secondary);
    font-weight: 500;
  }

  .quick-actions {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    flex-wrap: wrap;
  }

  .quick-btn {
    padding: 12px 24px;
    background: white;
    border: 2px solid var(--border);
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: var(--shadow-sm);
  }

  .quick-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
    border-color: var(--primary-solid);
    background: var(--primary);
    color: white;
  }

  .main-layout {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 24px;
  }

  .sidebar {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .section-card {
    background: white;
    border-radius: 16px;
    padding: 20px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }

  .section-header h3 {
    font-size: 15px;
    font-weight: 700;
    margin: 0;
    color: var(--text-primary);
  }

  .test-status {
    display: grid;
    gap: 10px;
  }

  .status-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: var(--bg-elevated);
    border-radius: 8px;
    font-size: 13px;
  }

  .status-label {
    color: var(--text-secondary);
    font-weight: 500;
  }

  .status-value {
    font-weight: 700;
    color: var(--text-primary);
  }

  .status-value.success {
    color: var(--success);
  }

  .status-value.error {
    color: var(--danger);
  }

  .sidebar-search-input {
    width: 100%;
    padding: 10px 12px;
    background: var(--bg-elevated);
    border: 2px solid var(--border);
    border-radius: 10px;
    font-size: 13px;
    transition: all 0.2s;
  }

  .sidebar-search-input:focus {
    outline: none;
    border-color: var(--primary-solid);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .search-stats {
    margin-top: 8px;
    text-align: center;
    font-size: 12px;
    color: var(--text-secondary);
  }

  .pattern-stats {
    display: flex;
    gap: 8px;
  }

  .stat-pill {
    flex: 1;
    padding: 8px 12px;
    background: var(--bg-elevated);
    border-radius: 8px;
    text-align: center;
    font-size: 12px;
  }

  .stat-label {
    color: var(--text-secondary);
    display: block;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .stat-value {
    font-weight: 700;
    color: var(--primary-solid);
    font-size: 16px;
  }

  .action-btn {
    width: 100%;
    padding: 14px 20px;
    border: none;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: var(--shadow);
  }

  .action-btn.primary {
    background: var(--primary);
    color: white;
  }

  .action-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .action-btn.secondary {
    background: white;
    color: var(--text-primary);
    border: 2px solid var(--border);
    padding: 10px 16px;
    font-size: 13px;
  }

  .action-btn.secondary:hover {
    border-color: var(--primary-solid);
    color: var(--primary-solid);
  }

  .action-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-top: 8px;
  }

  .main-content {
    background: white;
    border-radius: 16px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
    overflow: hidden;
  }

  .tabs {
    display: flex;
    border-bottom: 2px solid var(--border);
    background: var(--bg-elevated);
    overflow-x: auto;
  }

  .tab {
    padding: 16px 24px;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    font-size: 14px;
    font-weight: 600;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .tab:hover {
    color: var(--text-primary);
    background: var(--bg-hover);
  }

  .tab.active {
    color: var(--primary-solid);
    border-bottom-color: var(--primary-solid);
    background: white;
  }

  .tab-panel {
    display: none;
    padding: 24px;
    max-height: calc(100vh - 350px);
    overflow-y: auto;
  }

  .tab-panel.active {
    display: block;
  }

  .io-layout {
    display: grid;
    grid-template-rows: 1fr 1fr;
    gap: 24px;
    height: calc(100vh - 400px);
    min-height: 600px;
  }

  .io-section {
    display: flex;
    flex-direction: column;
  }

  .io-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }

  .io-title {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .io-icon {
    font-size: 20px;
  }

  .io-title h4 {
    font-size: 16px;
    font-weight: 700;
    margin: 0;
  }

  .io-actions {
    display: flex;
    gap: 6px;
    align-items: center;
  }

  .btn-icon-sm {
    width: 28px;
    height: 28px;
    padding: 0;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s;
  }

  .btn-icon-sm:hover {
    background: var(--primary);
    color: white;
    border-color: transparent;
    transform: scale(1.05);
  }

  .view-select {
    padding: 6px 10px;
    background: var(--bg-elevated);
    border: 2px solid var(--border);
    border-radius: 8px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
  }

  .textarea-wrapper {
    flex: 1;
    position: relative;
  }

  #input-text {
    width: 100%;
    height: 100%;
    padding: 16px;
    background: var(--bg-elevated);
    border: 2px solid var(--border);
    border-radius: 12px;
    font-family: var(--font-mono);
    font-size: 14px;
    line-height: 1.6;
    resize: none;
    transition: all 0.2s;
  }

  #input-text:focus {
    outline: none;
    border-color: var(--primary-solid);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .char-counter {
    position: absolute;
    bottom: 12px;
    right: 16px;
    font-size: 11px;
    color: var(--text-secondary);
    background: white;
    padding: 4px 8px;
    border-radius: 6px;
    box-shadow: var(--shadow-sm);
  }

  /* FIXED: Make results scrollable */
  .results-wrapper-fixed {
    flex: 1;
    background: var(--bg-elevated);
    border: 2px solid var(--border);
    border-radius: 12px;
    overflow-y: auto;
    overflow-x: hidden;
    max-height: 100%;
  }

  #results-container {
    padding: 16px;
    min-height: 100%;
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-secondary);
  }

  .empty-icon {
    font-size: 64px;
    margin-bottom: 16px;
  }

  .empty-state h3 {
    font-size: 20px;
    margin-bottom: 8px;
    color: var(--text-primary);
  }

  .results-footer {
    display: flex;
    gap: 16px;
    align-items: center;
    margin-top: 12px;
    flex-wrap: wrap;
  }

  .toggle-option {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: var(--text-secondary);
    cursor: pointer;
  }

  .toggle-option input {
    cursor: pointer;
    accent-color: var(--primary-solid);
  }

  .results-stats {
    margin-left: auto;
    font-size: 13px;
    color: var(--text-secondary);
  }

  .results-stats strong {
    color: var(--primary-solid);
    font-weight: 700;
  }

  .result-group {
    margin-bottom: 24px;
  }

  .result-group-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    background: white;
    border-radius: 10px;
    margin-bottom: 12px;
    box-shadow: var(--shadow-sm);
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .result-group-title {
    font-weight: 700;
    font-size: 15px;
    color: var(--text-primary);
  }

  .result-group-count {
    background: var(--primary);
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 700;
  }

  .result-items {
    display: grid;
    gap: 6px;
  }

  .result-item {
    padding: 10px 14px;
    background: white;
    border: 1px solid var(--border);
    border-radius: 8px;
    font-family: var(--font-mono);
    font-size: 13px;
    transition: all 0.2s;
    word-break: break-all;
  }

  .result-item:hover {
    border-color: var(--primary-solid);
    transform: translateX(4px);
    box-shadow: var(--shadow-sm);
  }

  .patterns-controls {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
  }

  .search-input {
    flex: 1;
    padding: 12px 16px;
    background: var(--bg-elevated);
    border: 2px solid var(--border);
    border-radius: 10px;
    font-size: 14px;
    transition: all 0.2s;
  }

  .search-input:focus {
    outline: none;
    border-color: var(--primary-solid);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .filter-select {
    padding: 12px 16px;
    background: var(--bg-elevated);
    border: 2px solid var(--border);
    border-radius: 10px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .filter-select:hover {
    border-color: var(--primary-solid);
  }

  .patterns-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
    max-height: calc(100vh - 600px);
    overflow-y: auto;
  }

  .pattern-card {
    background: var(--bg-elevated);
    border: 2px solid var(--border);
    border-radius: 12px;
    padding: 16px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .pattern-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-solid);
  }

  .pattern-card.active {
    background: var(--primary);
    color: white;
    border-color: transparent;
  }

  .pattern-card.hidden {
    display: none;
  }

  .pattern-card-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 8px;
  }

  .pattern-card-name {
    font-weight: 700;
    font-size: 14px;
  }

  .pattern-card-count {
    background: rgba(255,255,255,0.9);
    color: var(--primary-solid);
    padding: 4px 10px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 700;
  }

  .pattern-card.active .pattern-card-count {
    background: white;
  }

  .pattern-card-desc {
    font-size: 12px;
    opacity: 0.8;
  }

  .tests-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 2px solid var(--border);
  }

  .tests-header h3 {
    font-size: 24px;
    margin: 0;
  }

  .tests-controls {
    display: flex;
    gap: 8px;
  }

  /* FIXED: Make test results scrollable */
  .test-results-wrapper {
    max-height: calc(100vh - 500px);
    overflow-y: auto;
    overflow-x: hidden;
  }

  .test-item {
    padding: 16px;
    background: var(--bg-elevated);
    border-left: 4px solid var(--border);
    border-radius: 8px;
    margin-bottom: 12px;
  }

  .test-item.passed {
    border-left-color: var(--success);
    background: rgba(16, 185, 129, 0.05);
  }

  .test-item.failed {
    border-left-color: var(--danger);
    background: rgba(239, 68, 68, 0.05);
  }

  .test-item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
  }

  .test-item-name {
    font-weight: 700;
    font-size: 15px;
  }

  .test-item-status {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 700;
  }

  .test-item-status.passed {
    background: var(--success);
    color: white;
  }

  .test-item-status.failed {
    background: var(--danger);
    color: white;
  }

  .test-item-details {
    font-size: 13px;
    color: var(--text-secondary);
  }

  .pattern-tester {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
  }

  .tester-section h4,
  .tester-results-section h4 {
    font-size: 18px;
    margin-bottom: 16px;
  }

  .tester-input-group {
    margin-bottom: 20px;
  }

  .tester-input-group label {
    display: block;
    font-weight: 600;
    font-size: 13px;
    margin-bottom: 8px;
    color: var(--text-primary);
  }

  .tester-input,
  .tester-textarea {
    width: 100%;
    padding: 10px 14px;
    background: var(--bg-elevated);
    border: 2px solid var(--border);
    border-radius: 10px;
    font-size: 14px;
    font-family: var(--font-mono);
  }

  .tester-input:focus,
  .tester-textarea:focus {
    outline: none;
    border-color: var(--primary-solid);
  }

  .flag-options {
    display: flex;
    gap: 16px;
  }

  .flag-options label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: normal;
    font-size: 14px;
  }

  .tester-results {
    padding: 16px;
    background: var(--bg-elevated);
    border: 2px solid var(--border);
    border-radius: 12px;
    min-height: 400px;
    max-height: calc(100vh - 500px);
    overflow-y: auto;
  }

  .tester-match {
    padding: 8px 12px;
    background: white;
    border-left: 3px solid var(--success);
    border-radius: 6px;
    margin-bottom: 8px;
    font-family: var(--font-mono);
    font-size: 13px;
  }

  .testdata-header {
    margin-bottom: 24px;
  }

  .testdata-header h3 {
    font-size: 24px;
    margin-bottom: 8px;
  }

  .hint-text {
    color: var(--text-secondary);
    font-size: 14px;
  }

  .testdata-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 20px;
    max-height: calc(100vh - 500px);
    overflow-y: auto;
  }

  .testdata-card {
    background: var(--bg-elevated);
    border: 2px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .testdata-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-solid);
  }

  .testdata-card-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }

  .testdata-icon {
    font-size: 32px;
  }

  .testdata-title {
    font-weight: 700;
    font-size: 16px;
  }

  .testdata-desc {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 12px;
  }

  .testdata-stats {
    display: flex;
    gap: 12px;
    font-size: 12px;
    color: var(--text-secondary);
  }

  .analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
  }

  .stat-card-large {
    background: var(--primary);
    color: white;
    padding: 28px;
    border-radius: 16px;
    box-shadow: var(--shadow-lg);
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .stat-icon {
    font-size: 48px;
    opacity: 0.9;
  }

  .stat-content {
    flex: 1;
  }

  .stat-card-large .stat-value {
    font-size: 36px;
    font-weight: 800;
    color: white;
    margin-bottom: 4px;
  }

  .stat-card-large .stat-label {
    font-size: 14px;
    opacity: 0.9;
  }

  .chart-section {
    background: white;
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
  }

  .chart-section h3 {
    font-size: 18px;
    margin-bottom: 20px;
    color: var(--text-primary);
  }

  .chart-bar {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 16px;
  }

  .chart-label {
    flex: 0 0 180px;
    font-weight: 600;
    font-size: 14px;
  }

  .chart-track {
    flex: 1;
    height: 32px;
    background: var(--bg-elevated);
    border-radius: 16px;
    overflow: hidden;
    position: relative;
  }

  .chart-fill {
    height: 100%;
    background: var(--primary);
    transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 12px;
    color: white;
    font-weight: 700;
    font-size: 13px;
  }

  .insights-section {
    background: white;
    border-radius: 16px;
    padding: 24px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
  }

  .insights-section h3 {
    font-size: 18px;
    margin-bottom: 20px;
  }

  .insight-item {
    padding: 16px;
    background: var(--bg-elevated);
    border-left: 4px solid var(--primary-solid);
    border-radius: 8px;
    margin-bottom: 12px;
  }

  .insight-title {
    font-weight: 700;
    font-size: 14px;
    margin-bottom: 6px;
  }

  .insight-desc {
    font-size: 13px;
    color: var(--text-secondary);
  }

  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }

  .modal.active {
    display: flex;
  }

  .modal-content {
    background: white;
    border-radius: 20px;
    max-width: 700px;
    width: 90%;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    box-shadow: var(--shadow-lg);
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 24px;
    border-bottom: 2px solid var(--border);
  }

  .modal-header h3 {
    font-size: 20px;
    margin: 0;
  }

  .modal-close {
    width: 32px;
    height: 32px;
    border: none;
    background: var(--bg-elevated);
    border-radius: 8px;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .modal-close:hover {
    background: var(--danger);
    color: white;
  }

  .modal-body {
    padding: 24px;
    overflow-y: auto;
  }

  @media (max-width: 1200px) {
    .main-layout {
      grid-template-columns: 1fr;
    }

    .pattern-tester {
      grid-template-columns: 1fr;
    }
  }
</style>

<!-- Standalone Styles -->
<style id="standalone-styles">
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #f8fafc;
    color: #1e293b;
    padding: 24px;
    line-height: 1.6;
  }

  :root {
    --font-mono: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
  }
</style>

<!-- Tool Module Logic -->
<script type="module">
export const DevChefTool = {
  container: null,
  context: null,
  patterns: {},
  patternPresets: {},
  testSuite: {},
  testData: {},
  lastResults: {},
  performanceMetrics: {},

  init(container, context) {
    this.container = container;
    this.context = context;
    this.initializePatterns();
    this.initializePresets();
    this.initializeTestSuite();
    this.initializeTestData();
    this.renderPatternsGrid();
    this.renderTestDataGrid();
    this.setupEventListeners();
    this.updateStats();

    // Expose to window for callbacks
    window.DevChefTool = this;
  },

  initializePatterns() {
    // Complete 60+ pattern library with all categories
    this.patterns = {
      'web': {
        'urls': { name: 'üåê URLs', desc: 'HTTP/HTTPS URLs', regex: /https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/gi },
        'emails': { name: 'üìß Emails', desc: 'Email addresses', regex: /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g },
        'ipv4': { name: 'üåç IPv4', desc: 'IPv4 addresses', regex: /\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/g },
        'ipv6': { name: 'üåç IPv6', desc: 'IPv6 addresses', regex: /(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}/g },
        'domains': { name: 'üè† Domains', desc: 'Domain names', regex: /\b(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]\b/gi },
        'mac-address': { name: 'üîå MAC Address', desc: 'MAC addresses', regex: /\b([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})\b/g }
      },
      'security': {
        'aws-key': { name: 'üîë AWS Access Key', desc: 'AWS access keys', regex: /\b(AKIA[0-9A-Z]{16})\b/g },
        'aws-secret': { name: 'üîê AWS Secret', desc: 'AWS secret keys', regex: /\b[A-Za-z0-9/+=]{40}\b/g },
        'jwt': { name: 'üé´ JWT Token', desc: 'JSON Web Tokens', regex: /eyJ[A-Za-z0-9-_=]+\.[A-Za-z0-9-_=]+\.?[A-Za-z0-9-_.+/=]*/g },
        'api-key': { name: 'üóùÔ∏è API Keys', desc: 'Generic API keys', regex: /\b[A-Za-z0-9_-]{32,}\b/g },
        'ssh-key': { name: 'üîë SSH Keys', desc: 'SSH private keys', regex: /-----BEGIN (?:RSA|OPENSSH|DSA|EC) PRIVATE KEY-----[\s\S]+?-----END (?:RSA|OPENSSH|DSA|EC) PRIVATE KEY-----/g },
        'passwords': { name: 'üîí Password Patterns', desc: 'Common password patterns', regex: /(?:password|passwd|pwd)[\s:=]+[\S]+/gi }
      },
      'crypto': {
        'bitcoin': { name: '‚Çø Bitcoin', desc: 'Bitcoin addresses', regex: /\b[13][a-km-zA-HJ-NP-Z1-9]{25,34}\b|bc1[a-z0-9]{39,59}\b/g },
        'ethereum': { name: '‚ü† Ethereum', desc: 'Ethereum addresses', regex: /\b0x[a-fA-F0-9]{40}\b/g },
        'md5': { name: '#Ô∏è‚É£ MD5', desc: 'MD5 hashes', regex: /\b[a-fA-F0-9]{32}\b/g },
        'sha1': { name: '#Ô∏è‚É£ SHA1', desc: 'SHA1 hashes', regex: /\b[a-fA-F0-9]{40}\b/g },
        'sha256': { name: '#Ô∏è‚É£ SHA256', desc: 'SHA256 hashes', regex: /\b[a-fA-F0-9]{64}\b/g }
      },
      'identifiers': {
        'uuid': { name: 'üÜî UUID', desc: 'UUIDs (v4)', regex: /\b[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\b/gi },
        'guid': { name: 'üÜî GUID', desc: 'GUIDs', regex: /\{[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\}/g },
        'ssn': { name: 'üÜî SSN', desc: 'Social Security Numbers', regex: /\b\d{3}-\d{2}-\d{4}\b/g },
        'creditcards': { name: 'üí≥ Credit Cards', desc: 'Credit card numbers', regex: /\b(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|6(?:011|5[0-9]{2})[0-9]{12})\b/g }
      },
      'dates': {
        'iso-dates': { name: 'üìÖ ISO Dates', desc: 'ISO 8601 dates', regex: /\b\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d{3})?(?:Z|[+-]\d{2}:\d{2})?)?\b/g },
        'us-dates': { name: 'üìÖ US Dates', desc: 'MM/DD/YYYY format', regex: /\b(?:0?[1-9]|1[0-2])\/(?:0?[1-9]|[12]\d|3[01])\/(?:19|20)\d{2}\b/g },
        'timestamps': { name: '‚è∞ Timestamps', desc: 'Unix timestamps', regex: /\b1[0-9]{9,10}\b/g },
        'time': { name: '‚è∞ Time', desc: 'HH:MM:SS format', regex: /\b(?:[01]?[0-9]|2[0-3]):[0-5][0-9](?::[0-5][0-9])?\b/g }
      },
      'contact': {
        'phones-us': { name: 'üìû US Phones', desc: 'US phone numbers', regex: /\b(?:\+?1[-.\s]?)?\(?([2-9][0-9]{2})\)?[-.\s]?([2-9][0-9]{2})[-.\s]?([0-9]{4})\b/g },
        'phones-intl': { name: 'üìû Intl Phones', desc: 'International phones', regex: /\+?\d{1,4}[-.\s]?\(?\d{1,4}\)?[-.\s]?\d{1,4}[-.\s]?\d{1,9}/g },
        'zip-us': { name: 'üìÆ US ZIP', desc: 'US ZIP codes', regex: /\b\d{5}(?:-\d{4})?\b/g },
        'postal-ca': { name: 'üìÆ CA Postal', desc: 'Canadian postal codes', regex: /\b[A-Z]\d[A-Z]\s?\d[A-Z]\d\b/gi }
      },
      'financial': {
        'iban': { name: 'üè¶ IBAN', desc: 'IBAN numbers', regex: /\b[A-Z]{2}\d{2}[A-Z0-9]{4}\d{7}([A-Z0-9]?){0,16}\b/g },
        'swift': { name: 'üè¶ SWIFT', desc: 'SWIFT/BIC codes', regex: /\b[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?\b/g },
        'currencies': { name: 'üí∞ Currency', desc: 'Currency amounts', regex: /[$‚Ç¨¬£¬•‚Çπ]\s?\d+(?:,\d{3})*(?:\.\d{2})?|\d+(?:,\d{3})*(?:\.\d{2})?\s?(?:USD|EUR|GBP|JPY|INR)/g }
      },
      'code': {
        'html-tags': { name: 'üè∑Ô∏è HTML Tags', desc: 'HTML tags', regex: /<\/?[\w\s="/.':;#-\/]+>/g },
        'html-comments': { name: 'üí¨ HTML Comments', desc: 'HTML comments', regex: /<!--[\s\S]*?-->/g },
        'json-objects': { name: 'üì¶ JSON Objects', desc: 'JSON objects', regex: /\{[^{}]*\}/g },
        'xml-tags': { name: 'üìÑ XML Tags', desc: 'XML tags', regex: /<[^>]+>/g },
        'css-colors': { name: 'üé® CSS Colors', desc: 'Hex colors', regex: /#(?:[0-9a-fA-F]{3}){1,2}\b/g },
        'comments-js': { name: 'üí¨ JS Comments', desc: 'JavaScript comments', regex: /\/\/.*$|\/\*[\s\S]*?\*\//gm },
        'comments-python': { name: 'üí¨ Python Comments', desc: 'Python comments', regex: /#.*$/gm },
        'todos': { name: 'üìù TODOs', desc: 'TODO comments', regex: /(?:TODO|FIXME|HACK|XXX|NOTE).*$/gmi },
        'imports-js': { name: 'üì• JS Imports', desc: 'JavaScript imports', regex: /import\s+.*?from\s+['"].*?['"]/g },
        'imports-python': { name: 'üì• Python Imports', desc: 'Python imports', regex: /(?:from\s+[\w.]+\s+)?import\s+[\w.,\s*]+/g }
      },
      'logs': {
        'error-codes': { name: '‚ùå Error Codes', desc: 'Error messages', regex: /(?:ERROR|FATAL|CRITICAL).*$/gmi },
        'warning-codes': { name: '‚ö†Ô∏è Warnings', desc: 'Warning messages', regex: /(?:WARNING|WARN).*$/gmi },
        'status-codes': { name: 'üìä HTTP Status', desc: 'HTTP status codes', regex: /\b(?:[1-5]\d{2})\b/g },
        'log-levels': { name: 'üìä Log Levels', desc: 'Log level indicators', regex: /\b(?:DEBUG|INFO|WARN|ERROR|FATAL|TRACE)\b/g }
      },
      'text': {
        'words': { name: 'üìù Words', desc: 'Individual words', regex: /\b\w+\b/g },
        'sentences': { name: 'üìù Sentences', desc: 'Sentences', regex: /[A-Z][^.!?]*[.!?]/g },
        'quoted': { name: 'üí¨ Quoted Text', desc: 'Quoted strings', regex: /["']([^"']*?)["']/g },
        'hashtags': { name: '#Ô∏è‚É£ Hashtags', desc: 'Social hashtags', regex: /#\w+/g },
        'mentions': { name: '@Ô∏è‚É£ Mentions', desc: 'Social mentions', regex: /@\w+/g }
      },
      'numbers': {
        'integers': { name: 'üî¢ Integers', desc: 'Integer numbers', regex: /\b\d+\b/g },
        'floats': { name: 'üî¢ Floats', desc: 'Decimal numbers', regex: /\b\d+\.\d+\b/g },
        'percentages': { name: 'üìä Percentages', desc: 'Percentage values', regex: /\b\d+(?:\.\d+)?%/g },
        'versions': { name: 'üì¶ Versions', desc: 'Semantic versions', regex: /\b\d+\.\d+\.\d+(?:-[a-z0-9]+)?(?:\+[a-z0-9]+)?\b/gi }
      },
      'paths': {
        'file-paths': { name: 'üìÅ File Paths', desc: 'File system paths', regex: /(?:[A-Za-z]:)?[\\/](?:[^\\/\n]+[\\/])*[^\\/\n]+/g },
        'url-paths': { name: 'üåê URL Paths', desc: 'URL paths', regex: /\/[a-zA-Z0-9-._~:/?#[\]@!$&'()*+,;=%]*/g }
      }
    };
  },

  initializePresets() {
    this.patternPresets = {
      'security-audit': {
        name: 'Security Audit',
        icon: 'üîí',
        patterns: ['aws-key', 'aws-secret', 'jwt', 'api-key', 'ssh-key', 'passwords']
      },
      'data-privacy': {
        name: 'Data Privacy',
        icon: 'üõ°Ô∏è',
        patterns: ['emails', 'phones-us', 'ssn', 'creditcards', 'ipv4']
      },
      'web-scraping': {
        name: 'Web Scraping',
        icon: 'üåê',
        patterns: ['urls', 'emails', 'domains', 'html-tags', 'css-colors']
      },
      'log-analysis': {
        name: 'Log Analysis',
        icon: 'üìä',
        patterns: ['ipv4', 'timestamps', 'error-codes', 'status-codes', 'log-levels']
      }
    };
  },

  initializeTestSuite() {
    // Comprehensive test suite for patterns
    this.testSuite = {
      'urls': {
        positive: ['https://example.com', 'http://www.test.org/path?query=1', 'https://api.github.com/users'],
        negative: ['not a url', 'example', 'www.']
      },
      'emails': {
        positive: ['test@example.com', 'user.name@company.co.uk', 'admin+tag@domain.com'],
        negative: ['invalid@', '@domain.com', 'no-at-symbol.com']
      },
      'ipv4': {
        positive: ['192.168.1.1', '10.0.0.1', '255.255.255.0'],
        negative: ['256.1.1.1', '192.168.1', '192.168.1.1.1']
      },
      'uuid': {
        positive: ['550e8400-e29b-41d4-a716-446655440000', 'f47ac10b-58cc-4372-a567-0e02b2c3d479'],
        negative: ['not-a-uuid', '550e8400', '550e8400-e29b-41d4-a716-44665544000g']
      },
      'bitcoin': {
        positive: ['1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa', 'bc1qar0srrr7xfkvy5l643lydnw9re59gtzzwf5mdq'],
        negative: ['0A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa', 'invalid-bitcoin']
      },
      'ethereum': {
        positive: ['0x5aAeb6053F3E94C9b9A09f33669435E7Ef1BeAed', '0xfB6916095ca1df60bB79Ce92cE3Ea74c37c5d359'],
        negative: ['0x5aAeb6053F3E94C9b9A09f33669435E7Ef1BeAeg', '5aAeb6053F3E94C9b9A09f33669435E7Ef1BeAed']
      },
      'ssn': {
        positive: ['123-45-6789', '987-65-4321'],
        negative: ['12-345-6789', '123456789', '123-45-678']
      },
      'iso-dates': {
        positive: ['2024-01-15', '2024-12-31T23:59:59Z', '2024-06-15T14:30:00+00:00'],
        negative: ['2024-13-01', '15-01-2024', '2024/01/15']
      },
      'us-dates': {
        positive: ['01/15/2024', '12/31/2023', '6/1/2024'],
        negative: ['15/01/2024', '13/01/2024', '01-15-2024']
      },
      'phones-us': {
        positive: ['(555) 123-4567', '555-123-4567', '+1-555-123-4567'],
        negative: ['123-4567', '(555) 123-456']
      },
      'md5': {
        positive: ['5d41402abc4b2a76b9719d911017c592', '098f6bcd4621d373cade4e832627b4f6'],
        negative: ['5d41402abc4b2a76b9719d911017c59', '5d41402abc4b2a76b9719d911017c59g']
      },
      'sha256': {
        positive: ['e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855'],
        negative: ['5d41402abc4b2a76b9719d911017c592', 'not-sha256']
      },
      'jwt': {
        positive: ['eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIn0.dozjgNryP4J3jVmNHl0w5N_XgL0n3I9PlFUP0THsR8U'],
        negative: ['not-jwt', 'eyJhbGci']
      },
      'versions': {
        positive: ['1.0.0', '2.3.4-beta', '3.5.1+build.123'],
        negative: ['v1.0.0', '1.0', '1.0.0.0']
      }
    };
  },

  initializeTestData() {
    this.testData = {
      'web-mixed': {
        name: 'Web Mixed Data',
        icon: 'üåê',
        desc: 'URLs, emails, IPs, and domains',
        lines: 15,
        patterns: 12,
        data: `Visit https://example.com for more info
Contact us at support@example.com or admin@company.org
Server IP: 192.168.1.1
Backup IP: 10.0.0.50
Website: www.google.com
API: https://api.github.com/users
Email list: john@test.com, jane@example.net
IPv6: 2001:0db8:85a3:0000:0000:8a2e:0370:7334
Domain: subdomain.example.co.uk
Portal: https://portal.azure.com/signin
DNS: 8.8.8.8
Contact: info@startup.io
Gateway: 192.168.0.1
CDN: https://cdn.jsdelivr.net/npm/package
Help: help.desk@support.com`
      },
      'security-test': {
        name: 'Security Patterns',
        icon: 'üîí',
        desc: 'API keys, tokens, and secrets',
        lines: 10,
        patterns: 8,
        data: `AWS_ACCESS_KEY=AKIAIOSFODNN7EXAMPLE
AWS_SECRET=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
JWT=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIn0.dozjgNryP4J3jVmNHl0w5N_XgL0n3I9PlFUP0THsR8U
API_KEY=sk_test_4eC39HqLyjWDarjtT1zdp7dc
PASSWORD=MySecurePassword123!
DB_PASSWORD=admin:P@ssw0rd
ENCRYPTION_KEY=AES256_abcdefghijklmnopqrstuvwxyz12345
TOKEN=ghp_1234567890abcdefghijklmnopqrstuv
SSH_KEY=ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAAB
API_SECRET=sk_live_51HqLyjWDarjtT1zdp7dcABC`
      },
      'crypto-addresses': {
        name: 'Crypto Addresses',
        icon: '‚Çø',
        desc: 'Bitcoin, Ethereum, and hashes',
        lines: 12,
        patterns: 10,
        data: `Bitcoin: 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa
Ethereum: 0x5aAeb6053F3E94C9b9A09f33669435E7Ef1BeAed
BTC: bc1qar0srrr7xfkvy5l643lydnw9re59gtzzwf5mdq
ETH: 0xfB6916095ca1df60bB79Ce92cE3Ea74c37c5d359
MD5: 5d41402abc4b2a76b9719d911017c592
SHA1: 356a192b7913b04c54574d18c28d46e6395428ab
SHA256: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
BTC Testnet: 1BoatSLRHtKNngkdXEeobR76b53LETtpyT
File MD5: 098f6bcd4621d373cade4e832627b4f6
Commit SHA: d670460b4b4aece5915caf5c68d12f560a9fe3e4
Hash: a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3
Legacy BTC: 3J98t1WpEZ73CNmYviecrnyiWrnqRhWNLy`
      },
      'pii-data': {
        name: 'PII Test Data',
        icon: 'üÜî',
        desc: 'SSN, credit cards, phone numbers',
        lines: 10,
        patterns: 8,
        data: `SSN: 123-45-6789
Phone: (555) 123-4567
Credit Card: 4532015112830366
Email: john.doe@example.com
ZIP: 12345-6789
SSN: 987-65-4321
Card: 5425233430109903
Contact: +1-555-987-6543
AmEx: 378282246310005
Mobile: 555-234-5678`
      },
      'log-sample': {
        name: 'Application Logs',
        icon: 'üìä',
        desc: 'Log entries with errors and warnings',
        lines: 15,
        patterns: 10,
        data: `2024-01-15T10:30:45Z INFO Server started on port 8080
2024-01-15T10:31:02Z DEBUG Connecting to database at 192.168.1.100
2024-01-15T10:31:05Z INFO Database connection established
2024-01-15T10:32:15Z WARN High memory usage detected: 85%
2024-01-15T10:33:22Z ERROR Failed to process request: Connection timeout
2024-01-15T10:33:23Z ERROR HTTP 500 Internal Server Error
2024-01-15T10:34:01Z INFO Request from 203.0.113.42 - Status: 200
2024-01-15T10:35:15Z DEBUG Cache hit ratio: 92.5%
2024-01-15T10:36:30Z WARN Deprecated API endpoint called: /api/v1/legacy
2024-01-15T10:37:45Z ERROR Database query failed: Syntax error at line 15
2024-01-15T10:38:12Z INFO User login: user@example.com from 198.51.100.1
2024-01-15T10:39:00Z FATAL System crash - Attempting restart
2024-01-15T10:40:15Z INFO System recovered successfully
2024-01-15T10:41:30Z DEBUG Performance: Response time 125ms
2024-01-15T10:42:45Z WARN Rate limit exceeded for IP 192.0.2.146`
      },
      'code-sample': {
        name: 'Source Code',
        icon: 'üíª',
        desc: 'JavaScript/Python with comments',
        lines: 20,
        patterns: 12,
        data: `// TODO: Refactor this function
import React from 'react';
import { useState } from 'react';

/*
 * Main application component
 * FIXME: Add error handling
 */
function App() {
  // State management
  const [count, setCount] = useState(0);
  const API_URL = 'https://api.example.com/v1';

  // NOTE: This needs optimization
  const handleClick = () => {
    setCount(count + 1);
  };

  return <div className="app">Hello World</div>;
}

# Python example
from datetime import datetime
import json

# TODO: Add type hints
def process_data(input_file):
    # HACK: Temporary workaround
    data = json.load(input_file)
    timestamp = 1704067200
    version = "2.5.1"
    return data`
      }
    };
  },

  setupEventListeners() {
    // Input monitoring
    const input = this.container.querySelector('#input-text');
    input.addEventListener('input', () => {
      this.updateCharCount();
      this.updateStats();
    });

    // Quick actions
    this.container.querySelector('#run-tests-btn').addEventListener('click', () => this.runAllTests());
    this.container.querySelector('#load-test-data-btn').addEventListener('click', () => this.switchTab('testdata'));
    this.container.querySelector('#validate-patterns-btn').addEventListener('click', () => this.validateAllPatterns());
    this.container.querySelector('#pattern-tester-btn').addEventListener('click', () => this.switchTab('tester'));
    this.container.querySelector('#load-preset-btn').addEventListener('click', () => this.showPresetModal());
    this.container.querySelector('#performance-btn').addEventListener('click', () => this.runPerformanceTest());

    // Sidebar actions
    this.container.querySelector('#extract-btn').addEventListener('click', () => this.extractPatterns());
    this.container.querySelector('#select-all-btn').addEventListener('click', () => this.selectAll());
    this.container.querySelector('#clear-all-btn').addEventListener('click', () => this.clearAll());
    this.container.querySelector('#invert-btn').addEventListener('click', () => this.invertSelection());

    // IO actions
    this.container.querySelector('#paste-btn').addEventListener('click', () => this.pasteFromClipboard());
    this.container.querySelector('#clear-input-btn').addEventListener('click', () => this.clearInput());
    this.container.querySelector('#copy-btn').addEventListener('click', () => this.copyResults());
    this.container.querySelector('#download-btn').addEventListener('click', () => this.downloadResults());

    // Tab switching
    this.container.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', (e) => this.switchTab(e.target.dataset.tab));
    });

    // ENHANCED: Sidebar pattern search
    this.container.querySelector('#sidebar-pattern-search').addEventListener('input', (e) => {
      this.searchPatterns(e.target.value);
      this.updateSearchCount();
    });

    // ENHANCED: Pattern tab search
    this.container.querySelector('#pattern-search').addEventListener('input', (e) => {
      this.searchPatterns(e.target.value);
      this.updateSearchCount();
    });

    // Category filter
    this.container.querySelector('#category-filter').addEventListener('change', (e) => {
      this.filterByCategory(e.target.value);
      this.updateSearchCount();
    });

    // Clear search button
    this.container.querySelector('#clear-search-btn').addEventListener('click', () => {
      this.container.querySelector('#pattern-search').value = '';
      this.container.querySelector('#sidebar-pattern-search').value = '';
      this.searchPatterns('');
      this.updateSearchCount();
    });

    // Test actions
    this.container.querySelector('#run-all-tests-btn').addEventListener('click', () => this.runAllTests());
    this.container.querySelector('#export-tests-btn').addEventListener('click', () => this.exportTestResults());

    // Pattern tester
    this.container.querySelector('#test-pattern-btn').addEventListener('click', () => this.testCustomPattern());

    // Initial update
    this.updateCharCount();
    this.updateSearchCount();
  },

  switchTab(tabName) {
    this.container.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tabName));
    this.container.querySelectorAll('.tab-panel').forEach(p => p.classList.toggle('active', p.id === `${tabName}-panel`));

    if (tabName === 'analytics') this.updateAnalytics();
  },

  updateCharCount() {
    const text = this.container.querySelector('#input-text').value;
    this.container.querySelector('#char-count').textContent = text.length;
    this.container.querySelector('#line-count').textContent = text.split('\n').length;
  },

  updateStats() {
    const input = this.container.querySelector('#input-text').value;
    if (!input) {
      this.container.querySelector('#enabled-count').textContent = this.container.querySelectorAll('.pattern-card.active').length;
      this.container.querySelector('#matches-count').textContent = 0;
      return;
    }

    let enabledCount = this.container.querySelectorAll('.pattern-card.active').length;
    let totalMatches = 0;

    this.container.querySelectorAll('.pattern-card').forEach(card => {
      const patternId = card.dataset.patternId;
      const categoryId = card.dataset.categoryId;

      if (this.patterns[categoryId] && this.patterns[categoryId][patternId]) {
        const pattern = this.patterns[categoryId][patternId];
        const regex = new RegExp(pattern.regex.source, pattern.regex.flags);
        const matches = input.match(regex);
        const count = matches ? matches.length : 0;

        const countElement = card.querySelector('.pattern-card-count');
        if (countElement) {
          countElement.textContent = count;
        }

        if (count > 0 && card.classList.contains('active')) {
          totalMatches += count;
        }
      }
    });

    this.container.querySelector('#enabled-count').textContent = enabledCount;
    this.container.querySelector('#matches-count').textContent = totalMatches;
  },

  // ENHANCED: Pattern search with count
  searchPatterns(query) {
    const lowerQuery = query.toLowerCase().trim();

    this.container.querySelectorAll('.pattern-card').forEach(card => {
      const name = card.querySelector('.pattern-card-name').textContent.toLowerCase();
      const desc = card.querySelector('.pattern-card-desc').textContent.toLowerCase();

      if (!lowerQuery || name.includes(lowerQuery) || desc.includes(lowerQuery)) {
        card.classList.remove('hidden');
      } else {
        card.classList.add('hidden');
      }
    });

    // Sync both search boxes
    const sidebarSearch = this.container.querySelector('#sidebar-pattern-search');
    const patternSearch = this.container.querySelector('#pattern-search');
    if (sidebarSearch && sidebarSearch.value !== query) sidebarSearch.value = query;
    if (patternSearch && patternSearch.value !== query) patternSearch.value = query;
  },

  // NEW: Update search results count
  updateSearchCount() {
    const visibleCards = this.container.querySelectorAll('.pattern-card:not(.hidden)').length;
    const totalCards = this.container.querySelectorAll('.pattern-card').length;
    this.container.querySelector('#search-results-count').textContent =
      `${visibleCards} of ${totalCards} patterns`;
  },

  filterByCategory(categoryId) {
    this.container.querySelectorAll('.pattern-card').forEach(card => {
      if (!categoryId || card.dataset.categoryId === categoryId) {
        card.classList.remove('hidden');
      } else {
        card.classList.add('hidden');
      }
    });
  },

  selectAll() {
    this.container.querySelectorAll('.pattern-card:not(.hidden)').forEach(card => card.classList.add('active'));
    this.updateStats();
  },

  clearAll() {
    this.container.querySelectorAll('.pattern-card').forEach(card => card.classList.remove('active'));
    this.updateStats();
  },

  invertSelection() {
    this.container.querySelectorAll('.pattern-card:not(.hidden)').forEach(card => card.classList.toggle('active'));
    this.updateStats();
  },

  async pasteFromClipboard() {
    try {
      const text = await navigator.clipboard.readText();
      this.container.querySelector('#input-text').value = text;
      this.updateCharCount();
      this.updateStats();
    } catch (err) {
      alert('Failed to paste from clipboard');
    }
  },

  clearInput() {
    this.container.querySelector('#input-text').value = '';
    this.updateCharCount();
    this.updateStats();
  },

  extractPatterns() {
    const startTime = performance.now();
    const input = this.container.querySelector('#input-text').value;

    if (!input) {
      alert('Please enter some text first');
      return;
    }

    const activeCards = this.container.querySelectorAll('.pattern-card.active');

    if (activeCards.length === 0) {
      alert('Please select at least one pattern');
      return;
    }

    const results = {};
    const dedupe = this.container.querySelector('#dedupe-toggle').checked;
    const sortResults = this.container.querySelector('#sort-toggle').checked;

    activeCards.forEach(card => {
      const patternId = card.dataset.patternId;
      const categoryId = card.dataset.categoryId;

      if (this.patterns[categoryId] && this.patterns[categoryId][patternId]) {
        const pattern = this.patterns[categoryId][patternId];
        const regex = new RegExp(pattern.regex.source, pattern.regex.flags);
        const matches = [];
        let match;

        while ((match = regex.exec(input)) !== null) {
          const value = match[1] || match[0];
          matches.push(value);
        }

        if (matches.length > 0) {
          let processedMatches = matches;

          if (dedupe) {
            processedMatches = [...new Set(processedMatches)];
          }

          if (sortResults) {
            processedMatches = processedMatches.sort();
          }

          results[pattern.name] = processedMatches;
        }
      }
    });

    const endTime = performance.now();
    this.performanceMetrics.lastExtractionTime = Math.round(endTime - startTime);

    if (Object.keys(results).length === 0) {
      alert('No matches found for selected patterns');
      return;
    }

    this.lastResults = results;
    this.displayResults();
    this.updateAnalytics();
  },

  displayResults() {
    const container = this.container.querySelector('#results-container');
    const viewMode = this.container.querySelector('#view-mode').value;

    let html = '';
    let totalCount = 0;
    let uniqueCount = 0;

    if (viewMode === 'json') {
      html = `<pre style="font-family: var(--font-mono); font-size: 12px; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;">${JSON.stringify(this.lastResults, null, 2)}</pre>`;
    } else if (viewMode === 'csv') {
      html = '<pre style="font-family: var(--font-mono); font-size: 12px; white-space: pre-wrap; word-wrap: break-word;">';
      Object.keys(this.lastResults).forEach(pattern => {
        this.lastResults[pattern].forEach(item => {
          html += `"${pattern.replace(/"/g, '""')}","${String(item).replace(/"/g, '""')}"\n`;
        });
      });
      html += '</pre>';
    } else {
      // Grouped or flat view
      Object.keys(this.lastResults).forEach(pattern => {
        const items = this.lastResults[pattern];
        totalCount += items.length;
        uniqueCount += new Set(items).size;

        html += `
          <div class="result-group">
            <div class="result-group-header">
              <span class="result-group-title">${pattern}</span>
              <span class="result-group-count">${items.length}</span>
            </div>
            <div class="result-items">
              ${items.map(item => `<div class="result-item">${this.escapeHtml(String(item))}</div>`).join('')}
            </div>
          </div>
        `;
      });
    }

    container.innerHTML = html || '<div class="empty-state"><div class="empty-icon">üéØ</div><p>No results</p></div>';

    this.container.querySelector('#total-found').textContent = totalCount;
    this.container.querySelector('#unique-found').textContent = uniqueCount;
  },

  copyResults() {
    const viewMode = this.container.querySelector('#view-mode').value;
    let output = '';

    if (viewMode === 'json') {
      output = JSON.stringify(this.lastResults, null, 2);
    } else if (viewMode === 'csv') {
      Object.keys(this.lastResults).forEach(pattern => {
        this.lastResults[pattern].forEach(item => {
          output += `"${pattern.replace(/"/g, '""')}","${String(item).replace(/"/g, '""')}"\n`;
        });
      });
    } else {
      output = JSON.stringify(this.lastResults, null, 2);
    }

    navigator.clipboard.writeText(output).then(() => {
      const btn = this.container.querySelector('#copy-btn');
      const originalText = btn.textContent;
      btn.textContent = '‚úì';
      setTimeout(() => btn.textContent = originalText, 2000);
    });
  },

  downloadResults() {
    const viewMode = this.container.querySelector('#view-mode').value;
    let output = '';
    let filename = `extraction-${Date.now()}`;
    let mimeType = 'application/json';

    if (viewMode === 'json') {
      output = JSON.stringify(this.lastResults, null, 2);
      filename += '.json';
    } else if (viewMode === 'csv') {
      Object.keys(this.lastResults).forEach(pattern => {
        this.lastResults[pattern].forEach(item => {
          output += `"${pattern.replace(/"/g, '""')}","${String(item).replace(/"/g, '""')}"\n`;
        });
      });
      filename += '.csv';
      mimeType = 'text/csv';
    } else {
      output = JSON.stringify(this.lastResults, null, 2);
      filename += '.json';
    }

    const blob = new Blob([output], { type: mimeType });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
  },

  renderPatternsGrid() {
    const grid = this.container.querySelector('#patterns-grid');
    let html = '';

    Object.keys(this.patterns).forEach(categoryId => {
      const category = this.patterns[categoryId];

      Object.keys(category).forEach(patternId => {
        const pattern = category[patternId];

        html += `
          <div class="pattern-card"
               data-pattern-id="${patternId}"
               data-category-id="${categoryId}"
               onclick="this.classList.toggle('active'); window.DevChefTool.updateStats()">
            <div class="pattern-card-header">
              <div class="pattern-card-name">${pattern.name}</div>
              <div class="pattern-card-count">0</div>
            </div>
            <div class="pattern-card-desc">${pattern.desc}</div>
          </div>
        `;
      });
    });

    grid.innerHTML = html;
  },

  renderTestDataGrid() {
    const grid = this.container.querySelector('#testdata-grid');
    let html = '';

    Object.keys(this.testData).forEach(key => {
      const data = this.testData[key];
      html += `
        <div class="testdata-card" onclick="window.DevChefTool.loadTestData('${key}')">
          <div class="testdata-card-header">
            <div class="testdata-icon">${data.icon}</div>
            <div>
              <div class="testdata-title">${data.name}</div>
            </div>
          </div>
          <div class="testdata-desc">${data.desc}</div>
          <div class="testdata-stats">
            <span>üìù ${data.lines} lines</span>
            <span>üéØ ${data.patterns} patterns</span>
          </div>
        </div>
      `;
    });

    grid.innerHTML = html;
  },

  loadTestData(key) {
    const data = this.testData[key];
    if (!data) return;

    this.container.querySelector('#input-text').value = data.data;
    this.switchTab('extract');
    this.updateCharCount();
    this.updateStats();
  },

  // FIXED: Run all tests with proper validation
  runAllTests() {
    const startTime = performance.now();
    const results = [];
    let passed = 0;
    let failed = 0;

    Object.keys(this.testSuite).forEach(patternId => {
      const testCase = this.testSuite[patternId];

      let pattern = null;
      let categoryId = null;

      Object.keys(this.patterns).forEach(cat => {
        if (this.patterns[cat][patternId]) {
          pattern = this.patterns[cat][patternId];
          categoryId = cat;
        }
      });

      if (!pattern) return;

      let positivePass = 0;
      let positiveFail = 0;

      testCase.positive.forEach(testInput => {
        const regex = new RegExp(pattern.regex.source, pattern.regex.flags);
        if (regex.test(testInput)) {
          positivePass++;
        } else {
          positiveFail++;
        }
      });

      let negativePass = 0;
      let negativeFail = 0;

      testCase.negative.forEach(testInput => {
        const regex = new RegExp(pattern.regex.source, pattern.regex.flags);
        if (!regex.test(testInput)) {
          negativePass++;
        } else {
          negativeFail++;
        }
      });

      const totalPass = positivePass + negativePass;
      const totalFail = positiveFail + negativeFail;
      const testPassed = totalFail === 0;

      if (testPassed) passed++;
      else failed++;

      results.push({
        name: pattern.name,
        passed: testPassed,
        positivePass,
        positiveFail,
        negativePass,
        negativeFail,
        details: `${totalPass}/${totalPass + totalFail} assertions passed`
      });
    });

    const endTime = performance.now();
    const duration = Math.round(endTime - startTime);

    const total = passed + failed;
    this.container.querySelector('#total-tests').textContent = total;
    this.container.querySelector('#passed-tests').textContent = passed;
    this.container.querySelector('#failed-tests').textContent = failed;
    this.container.querySelector('#test-coverage').textContent = Math.round((passed / total) * 100) + '%';

    this.displayTestResults(results, duration);
    this.switchTab('tests');
  },

  displayTestResults(results, duration) {
    const container = this.container.querySelector('#test-results');

    let html = `
      <div class="test-summary" style="padding: 20px; background: var(--bg-elevated); border-radius: 12px; margin-bottom: 20px;">
        <h4 style="margin-bottom: 12px;">Test Summary</h4>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
          <div><strong>Total:</strong> ${results.length}</div>
          <div style="color: var(--success);"><strong>Passed:</strong> ${results.filter(r => r.passed).length}</div>
          <div style="color: var(--danger);"><strong>Failed:</strong> ${results.filter(r => !r.passed).length}</div>
          <div><strong>Duration:</strong> ${duration}ms</div>
        </div>
      </div>
    `;

    results.forEach(result => {
      html += `
        <div class="test-item ${result.passed ? 'passed' : 'failed'}">
          <div class="test-item-header">
            <span class="test-item-name">${result.name}</span>
            <span class="test-item-status ${result.passed ? 'passed' : 'failed'}">
              ${result.passed ? '‚úì PASSED' : '‚úó FAILED'}
            </span>
          </div>
          <div class="test-item-details">
            ${result.details}<br>
            Positive: ${result.positivePass}/${result.positivePass + result.positiveFail} |
            Negative: ${result.negativePass}/${result.negativePass + result.negativeFail}
          </div>
        </div>
      `;
    });

    container.innerHTML = html;
  },

  exportTestResults() {
    const results = {
      timestamp: new Date().toISOString(),
      summary: {
        total: this.container.querySelector('#total-tests').textContent,
        passed: this.container.querySelector('#passed-tests').textContent,
        failed: this.container.querySelector('#failed-tests').textContent,
        coverage: this.container.querySelector('#test-coverage').textContent
      }
    };

    const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `test-results-${Date.now()}.json`;
    a.click();
    URL.revokeObjectURL(url);
  },

  validateAllPatterns() {
    let validCount = 0;
    let invalidCount = 0;

    Object.keys(this.patterns).forEach(categoryId => {
      const category = this.patterns[categoryId];

      Object.keys(category).forEach(patternId => {
        const pattern = category[patternId];

        try {
          new RegExp(pattern.regex.source, pattern.regex.flags);
          validCount++;
        } catch (e) {
          invalidCount++;
          console.error(`Invalid pattern: ${pattern.name}`, e);
        }
      });
    });

    alert(`Pattern Validation Complete\n\nValid: ${validCount}\nInvalid: ${invalidCount}\n\n${invalidCount === 0 ? 'All patterns are valid!' : 'Some patterns need review.'}`);
  },

  testCustomPattern() {
    const regexStr = this.container.querySelector('#tester-regex').value;
    const testInput = this.container.querySelector('#tester-input').value;

    if (!regexStr || !testInput) {
      alert('Please provide both regex pattern and test input');
      return;
    }

    try {
      let flags = '';
      if (this.container.querySelector('#flag-g').checked) flags += 'g';
      if (this.container.querySelector('#flag-i').checked) flags += 'i';
      if (this.container.querySelector('#flag-m').checked) flags += 'm';

      const regex = new RegExp(regexStr, flags);
      const matches = [];
      let match;

      while ((match = regex.exec(testInput)) !== null) {
        matches.push({
          full: match[0],
          groups: match.slice(1),
          index: match.index
        });
      }

      const resultsDiv = this.container.querySelector('#tester-results');

      if (matches.length === 0) {
        resultsDiv.innerHTML = '<div class="empty-state"><p>No matches found</p></div>';
        return;
      }

      let html = `
        <div style="margin-bottom: 16px; padding: 12px; background: white; border-radius: 8px;">
          <strong>Found ${matches.length} match(es)</strong>
        </div>
      `;

      matches.forEach((m, idx) => {
        html += `
          <div class="tester-match">
            <div style="font-weight: 700; margin-bottom: 4px;">Match #${idx + 1} (index: ${m.index})</div>
            <div style="margin-bottom: 4px;"><strong>Full:</strong> ${this.escapeHtml(m.full)}</div>
            ${m.groups.length > 0 ? `<div><strong>Groups:</strong> ${m.groups.map((g, i) => `[${i}]: ${this.escapeHtml(g || 'undefined')}`).join(', ')}</div>` : ''}
          </div>
        `;
      });

      resultsDiv.innerHTML = html;

    } catch (e) {
      alert(`Invalid regex pattern: ${e.message}`);
    }
  },

  runPerformanceTest() {
    const testSizes = [1000, 5000, 10000, 50000];
    const results = [];

    testSizes.forEach(size => {
      const testData = 'test@example.com '.repeat(size / 20) +
                      'https://example.com '.repeat(size / 20) +
                      '192.168.1.1 '.repeat(size / 15);

      const pattern = this.patterns.web.urls;
      const regex = new RegExp(pattern.regex.source, pattern.regex.flags);

      const startTime = performance.now();
      const matches = testData.match(regex);
      const endTime = performance.now();

      results.push({
        size,
        matches: matches ? matches.length : 0,
        time: Math.round(endTime - startTime)
      });
    });

    this.showPerformanceResults(results);
  },

  showPerformanceResults(results) {
    const modal = this.container.querySelector('#performance-modal');
    const modalBody = this.container.querySelector('#performance-modal-body');

    let html = `
      <div style="margin-bottom: 20px;">
        <h4>Performance Test Results</h4>
        <p class="hint-text">Testing URL extraction with varying input sizes</p>
      </div>
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="background: var(--bg-elevated);">
            <th style="padding: 12px; text-align: left;">Input Size (chars)</th>
            <th style="padding: 12px; text-align: right;">Matches Found</th>
            <th style="padding: 12px; text-align: right;">Time (ms)</th>
            <th style="padding: 12px; text-align: right;">Rate (chars/ms)</th>
          </tr>
        </thead>
        <tbody>
    `;

    results.forEach(result => {
      const rate = Math.round(result.size / result.time);
      html += `
        <tr style="border-bottom: 1px solid var(--border);">
          <td style="padding: 12px;">${result.size.toLocaleString()}</td>
          <td style="padding: 12px; text-align: right;">${result.matches}</td>
          <td style="padding: 12px; text-align: right;">${result.time}</td>
          <td style="padding: 12px; text-align: right;">${rate.toLocaleString()}</td>
        </tr>
      `;
    });

    html += `
        </tbody>
      </table>
      <div style="margin-top: 20px; padding: 16px; background: var(--bg-elevated); border-radius: 8px;">
        <strong>Summary:</strong>
        Performance scales linearly with input size.
        Average processing rate: ${Math.round(results.reduce((sum, r) => sum + (r.size / r.time), 0) / results.length).toLocaleString()} chars/ms
      </div>
    `;

    modalBody.innerHTML = html;
    modal.classList.add('active');

    const closeBtn = modal.querySelector('.modal-close');
    closeBtn.onclick = () => modal.classList.remove('active');
    modal.onclick = (e) => {
      if (e.target === modal) modal.classList.remove('active');
    };
  },

  showPresetModal() {
    const modal = this.container.querySelector('#preset-modal');
    const modalBody = this.container.querySelector('#preset-modal-body');

    let html = '<div style="display: grid; gap: 16px;">';
    Object.keys(this.patternPresets).forEach(presetKey => {
      const preset = this.patternPresets[presetKey];
      html += `
        <div class="preset-card" onclick="window.DevChefTool.loadPresetAndClose('${presetKey}')" style="
          padding: 20px;
          background: var(--bg-elevated);
          border: 2px solid var(--border);
          border-radius: 12px;
          cursor: pointer;
          transition: all 0.2s;
        " onmouseover="this.style.borderColor='var(--primary-solid)'" onmouseout="this.style.borderColor='var(--border)'">
          <div style="font-size: 24px; margin-bottom: 8px;">${preset.icon}</div>
          <div style="font-weight: 700; font-size: 16px; margin-bottom: 8px;">${preset.name}</div>
          <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
            ${preset.patterns.length} patterns included
          </div>
          <div style="font-size: 12px; color: var(--text-secondary);">
            ${preset.patterns.join(', ')}
          </div>
        </div>
      `;
    });
    html += '</div>';

    modalBody.innerHTML = html;
    modal.classList.add('active');

    const closeBtn = modal.querySelector('.modal-close');
    closeBtn.onclick = () => modal.classList.remove('active');
    modal.onclick = (e) => {
      if (e.target === modal) modal.classList.remove('active');
    };
  },

  loadPresetAndClose(presetKey) {
    const preset = this.patternPresets[presetKey];
    if (!preset) return;

    this.clearAll();

    preset.patterns.forEach(patternId => {
      const card = this.container.querySelector(`.pattern-card[data-pattern-id="${patternId}"]`);
      if (card) {
        card.classList.add('active');
      }
    });

    this.updateStats();
    const modal = this.container.querySelector('#preset-modal');
    modal.classList.remove('active');
  },

  updateAnalytics() {
    if (!this.lastResults || Object.keys(this.lastResults).length === 0) {
      return;
    }

    let totalMatches = 0;
    let uniqueItems = 0;
    const patternTypes = Object.keys(this.lastResults).length;

    Object.values(this.lastResults).forEach(matches => {
      totalMatches += matches.length;
      uniqueItems += new Set(matches).size;
    });

    this.container.querySelector('#analytics-total').textContent = totalMatches;
    this.container.querySelector('#analytics-unique').textContent = uniqueItems;
    this.container.querySelector('#analytics-types').textContent = patternTypes;
    this.container.querySelector('#analytics-perf').textContent = (this.performanceMetrics.lastExtractionTime || 0) + 'ms';

    const distributionChart = this.container.querySelector('#distribution-chart');
    let chartHtml = '';
    const maxCount = Math.max(...Object.values(this.lastResults).map(arr => arr.length));

    Object.keys(this.lastResults).forEach(patternName => {
      const count = this.lastResults[patternName].length;
      const percentage = maxCount > 0 ? (count / maxCount) * 100 : 0;

      chartHtml += `
        <div class="chart-bar">
          <div class="chart-label">${patternName}</div>
          <div class="chart-track">
            <div class="chart-fill" style="width: ${percentage}%">${count}</div>
          </div>
        </div>
      `;
    });
    distributionChart.innerHTML = chartHtml;

    const insights = this.generateInsights();
    const insightsList = this.container.querySelector('#insights-list');
    let insightsHtml = '';
    insights.forEach(insight => {
      insightsHtml += `
        <div class="insight-item">
          <div class="insight-title">${insight.icon} ${insight.title}</div>
          <div class="insight-desc">${insight.description}</div>
        </div>
      `;
    });
    insightsList.innerHTML = insightsHtml;
  },

  generateInsights() {
    const insights = [];

    const sortedPatterns = Object.entries(this.lastResults)
      .sort((a, b) => b[1].length - a[1].length);

    if (sortedPatterns.length > 0) {
      const [topPattern, topMatches] = sortedPatterns[0];
      insights.push({
        icon: 'üèÜ',
        title: 'Most Common Pattern',
        description: `${topPattern} appears ${topMatches.length} times in your text.`
      });
    }

    const securityPatterns = ['üîë AWS Access Key', 'üîê AWS Secret', 'üîí Password Patterns', 'üóùÔ∏è API Keys'];
    const foundSecurity = Object.keys(this.lastResults).filter(p => securityPatterns.includes(p));
    if (foundSecurity.length > 0) {
      insights.push({
        icon: '‚ö†Ô∏è',
        title: 'Security Alert',
        description: `Found ${foundSecurity.length} security-sensitive pattern(s). Review before sharing.`
      });
    }

    if (this.performanceMetrics.lastExtractionTime) {
      const speed = this.performanceMetrics.lastExtractionTime < 100 ? 'excellent' :
                    this.performanceMetrics.lastExtractionTime < 500 ? 'good' : 'moderate';
      insights.push({
        icon: '‚ö°',
        title: 'Performance',
        description: `Extraction completed in ${this.performanceMetrics.lastExtractionTime}ms - ${speed} performance.`
      });
    }

    return insights;
  },

  escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  },

  onInput(input, context) {
    this.container.querySelector('#input-text').value = input;
    this.updateCharCount();
    this.updateStats();
    return { output: "" };
  },

  cleanup(context) {}
};

// Standalone mode
if (typeof window !== 'undefined' && !window.DevChef) {
  document.addEventListener('DOMContentLoaded', () => {
    const isStandalone = !document.querySelector('#workspace');

    if (isStandalone) {
      const standaloneContext = {
        input: "",
        output: "",
        setInput(val) { this.input = val; },
        setOutput(val) { this.output = val; },
        getInput() { return this.input; },
        getOutput() { return this.output; }
      };

      const template = document.querySelector('#tool-ui');
      if (template) {
        document.body.innerHTML = template.innerHTML;
        DevChefTool.init(document.body, standaloneContext);
      }
    }
  });
}
</script>

</body>
</html>
